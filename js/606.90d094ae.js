"use strict";(self["webpackChunkMPS"]=self["webpackChunkMPS"]||[]).push([[606],{52934:(e,t,o)=>{o.d(t,{UF:()=>i,OO:()=>s,jT:()=>n,RM:()=>r});const i={m:0,cm:1,mm:2,inch:3,feet:4},s={m:1,cm:100,mm:1e3,inch:39.3700787,feet:3.2808399},n={plane:0,curved:1,sphere:2,custom:3,none:100},r={front:0,left:1,right:2,back:3,top:4,bottom:5}},63898:(e,t,o)=>{o.d(t,{u:()=>i});class i{constructor(){this.uId="",this.customName="",this.modelName="",this.lensName="",this.aspectRatio=0,this.imageAspectRatio=0,this.offset=0,this.texture="",this.throwRatio=0,this.throwRatioMin=0,this.throwRatioMax=0,this.x=0,this.y=0,this.z=0,this.projectionDistance=0,this.ambientContrast=1,this.brightnessOnScreenNit=1,this.rotateX=0,this.rotateY=0,this.rotateZ=0,this.lensShiftH=0,this.lensShiftHMin=0,this.lensShiftHMax=0,this.lensShiftV=0,this.lensShiftVMin=0,this.lensShiftVMax=0,this.isShowBlendingGuideLine=!1,this.blendingGuideLineL=0,this.blendingGuideLineR=0,this.blendingGuideLineT=0,this.blendingGuideLineB=0,this.resolutionX=0,this.resolutionY=0,this.minDistance=0,this.maxDistance=0}}},64750:(e,t,o)=>{o.d(t,{i0:()=>n,wp:()=>r,Sv:()=>c,gh:()=>h,vc:()=>l,IR:()=>d,T6:()=>m,vn:()=>u,FT:()=>p,fj:()=>_,X5:()=>b,S0:()=>j,G1:()=>S,yE:()=>f,CP:()=>g,p:()=>w,e8:()=>y});o(10071),o(17965),o(67280),o(60979),o(76105),o(12396),o(64303);var i=o(56417),s=o(55488);function n(e,t,o,s){i.Z.create({message:e,color:"primary",position:"top",actions:[{label:t,color:"yellow",handler:()=>{s()}},{label:o,color:"white",handler:()=>{}}]})}function r(e,t){i.Z.create({message:e,color:"negative",position:"top",actions:[{label:t,color:"yellow",handler:()=>{}}]})}const c=(e,t)=>{const o=document.createElement("a"),i=a(t),s=document.createEvent("HTMLEvents");s.initEvent("click",!0,!0),o.download=e,o.href=URL.createObjectURL(i),o.click(),o.remove()},a=e=>{const t=e.split(";base64,"),o=t[0].split(":")[1],i=window.atob(t[1]),s=i.length,n=new Uint8Array(s);for(let r=0;r<s;++r)n[r]=i.charCodeAt(r);return new Blob([n],{type:o})},h=e=>{const t=s.default.state.projector.projectors.find((t=>t.uId===e));if(!t)return 1;const o=t.projectionDistance/t.throwRatio,i=o/t.aspectRatio,n=o*i,r=s.default.state.projector.projectorModels.vvkProjectorModels.find((e=>e.ModelName===t.modelName)).Brightness.value,c=r/n,a=(c+s.default.state.room.brightness)/s.default.state.room.brightness;return a.toFixed(2)},l=e=>{const t=s.default.state.projector.projectors.find((t=>t.uId===e));if(!t)return 1;const o=t.projectionDistance/t.throwRatio,i=o/t.aspectRatio,n=o*i,r=s.default.state.projector.projectorModels.vvkProjectorModels.find((e=>e.ModelName===t.modelName)).Brightness.value,c=r/n,a=c*s.default.state.screen.screenGain/Math.PI;return a.toFixed(1)},d=e=>!!e["Lens Shift"],m=e=>!!e["Optional Lens"],u=(e,t)=>{const o=t/s.default.state.common.unitRatio;if(!e.Distance){for(let t=0;t<e["Optional Lens"].length;t++){const i=s.default.state.projector.projectorLens.vvkOptionalLens.find((o=>o["Part Name"]===e["Optional Lens"][t]));if(i&&(i.Distance.max>=o&&i.Distance.min<=o))return!0}return!1}return e.Distance.min<=o&&e.Distance.max>=o},p=(e,t)=>e.ModelName.toLowerCase().includes(t.toLowerCase()),_=(e,t)=>{const[o,i]=t.split("-");return e.Brightness.value>=+o&&e.Brightness.value<=+i},b=(e,t)=>e.Resolution.Desc===t,j=(e,t)=>e.AspectRatio===t,S=(e,t)=>{const[o,i]=t.split("-");if(!e["Throw Ratio"]){for(let t=0;t<e["Optional Lens"].length;t++){const n=s.default.state.projector.projectorLens.vvkOptionalLens.find((o=>o["Part Name"]===e["Optional Lens"][t]));if(n&&(n["Throw Ratio"].min>=+o&&n["Throw Ratio"].min<=+i||n["Throw Ratio"].max>=+o&&n["Throw Ratio"].max<=+i))return!0}return!1}return e["Throw Ratio"].min>=+o&&e["Throw Ratio"].min<=+i||e["Throw Ratio"].max>=+o&&e["Throw Ratio"].max<=+i},f=(e,t)=>{const[o,i]=t.split("-"),s="kg"===e.Weight.unit?e.Weight.value:e.Weight.value/1e3;return s>=+o&&s<=+i},g=(e,t)=>{const o=document.createElement("a");if(o.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),o.setAttribute("download",e),document.createEvent){const e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),o.dispatchEvent(e)}else o.click()},w=()=>{let e="#";for(let t=0;t<6;t++)e+=parseInt(16*Math.random()).toString(16);return e},y=e=>{const t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),o=window.location.search.substr(1).match(t);return null!=o?unescape(o[2]):null}},89606:(e,t,o)=>{o.r(t),o.d(t,{default:()=>ee});var i=o(83673),s=o(62323),n=o(98880);const r=(0,i.HX)("data-v-1c1f23ee");(0,i.dD)("data-v-1c1f23ee");const c={class:"fit",id:"threeView"};(0,i.Cn)();const a=r(((e,t,o,a,h,l)=>{const d=(0,i.up)("q-tooltip"),m=(0,i.up)("q-btn"),u=(0,i.up)("q-item-section"),p=(0,i.up)("q-icon"),_=(0,i.up)("q-item"),b=(0,i.up)("q-list"),j=(0,i.up)("ProjectorDetail"),S=(0,i.up)("q-resize-observer"),f=(0,i.up)("q-page"),g=(0,i.Q2)("ripple");return(0,i.wg)(),(0,i.j4)(f,{class:"flex flex-center","style-fn":l.stylePage},{default:r((()=>[(0,i.Wm)("div",c,[(0,i.Wm)(m,{push:"",dense:"","text-color":"primary",color:e.$q.dark.isActive?"grey-8":"white",icon:"crop_din",class:"q-ml-sm q-mt-sm absolute-top-left",style:{"z-index":"10"},onClick:l.frontCamera},{default:r((()=>[(0,i.Wm)(d,null,{default:r((()=>[(0,i.Uk)((0,s.zw)(e.$t("frontView")),1)])),_:1})])),_:1},8,["color","onClick"]),(0,i.Wm)(m,{push:"",dense:"","text-color":"primary",color:e.$q.dark.isActive?"grey-8":"white",icon:"navigate_before",style:{"z-index":"10",top:"40px"},class:"q-ml-sm q-mt-sm absolute-top-left",onClick:l.sideCamera},{default:r((()=>[(0,i.Wm)(d,null,{default:r((()=>[(0,i.Uk)((0,s.zw)(e.$t("sideView")),1)])),_:1})])),_:1},8,["color","onClick"]),(0,i.Wm)(m,{push:"",dense:"","text-color":"primary",color:e.$q.dark.isActive?"grey-8":"white",icon:"expand_more",style:{"z-index":"10",top:"80px"},class:"q-ml-sm q-mt-sm absolute-top-left",onClick:l.topCamera},{default:r((()=>[(0,i.Wm)(d,null,{default:r((()=>[(0,i.Uk)((0,s.zw)(e.$t("topView")),1)])),_:1})])),_:1},8,["color","onClick"]),(0,i.wy)((0,i.Wm)(m,{push:"",dense:"","text-color":"primary",color:e.$q.dark.isActive?"grey-8":"white",icon:"undo",style:{"z-index":"999",right:"40px"},class:"q-mr-sm q-mb-sm absolute-bottom-right",onClick:l.undo},null,8,["color","onClick"]),[[n.F8,l.showUndo]]),(0,i.wy)((0,i.Wm)(m,{push:"",dense:"","text-color":"primary",color:e.$q.dark.isActive?"grey-8":"white",icon:"redo",style:{"z-index":"999"},class:"q-mr-sm q-mb-sm absolute-bottom-right",onClick:l.redo},null,8,["color","onClick"]),[[n.F8,l.showRedo]]),(0,i.wy)((0,i.Wm)(b,{class:"absolute",onContextmenu:t[1]||(t[1]=(0,n.iM)((()=>{}),["prevent"])),style:[{background:e.$q.dark.isActive?"#121212":"#ffffff",left:h.contextmenuLeft,top:h.contextmenuTop},{"max-width":"350px","z-index":"10"}],bordered:""},{default:r((()=>[(0,i.wy)((0,i.Wm)(_,{clickable:"",onMousedown:l.clickDeleteProjector},{default:r((()=>[(0,i.Wm)(u,null,{default:r((()=>[(0,i.Uk)((0,s.zw)(e.$t("delete")),1)])),_:1}),(0,i.Wm)(u,{avatar:""},{default:r((()=>[(0,i.Wm)(p,{name:"delete_outline",color:"primary"})])),_:1})])),_:1},8,["onMousedown"]),[[g]]),(0,i.wy)((0,i.Wm)(_,{clickable:"",onMousedown:l.clickCopyProjector},{default:r((()=>[(0,i.Wm)(u,null,{default:r((()=>[(0,i.Uk)((0,s.zw)(e.$t("copy")),1)])),_:1}),(0,i.Wm)(u,{avatar:""},{default:r((()=>[(0,i.Wm)(p,{name:"file_copy",color:"primary"})])),_:1})])),_:1},8,["onMousedown"]),[[g]]),(0,i.wy)((0,i.Wm)(_,{clickable:"",onMousedown:l.clickEditProjector},{default:r((()=>[(0,i.Wm)(u,null,{default:r((()=>[(0,i.Uk)((0,s.zw)(e.$t("edit")),1)])),_:1}),(0,i.Wm)(u,{avatar:""},{default:r((()=>[(0,i.Wm)(p,{name:"edit",color:"primary"})])),_:1})])),_:1},8,["onMousedown"]),[[g]])])),_:1},8,["style"]),[[n.F8,h.isShowContextmenu]]),(0,i.Wm)(j),(0,i.Wm)(S,{onResize:l.resizeCanvas,debounce:"100"},null,8,["onResize"])])])),_:1},8,["style-fn"])}));var h=o(90515),l=o.n(h),d=o(13991),m=o(87874);const u=(0,i.HX)("data-v-4ff7e216");(0,i.dD)("data-v-4ff7e216");const p={class:"absolute absolute-bottom-left detail-wrapper",style:{"z-index":"10"}},_={key:0,class:"text-primary"},b={key:1};(0,i.Cn)();const j=u(((e,t,o,r,c,a)=>{const h=(0,i.up)("q-td"),l=(0,i.up)("q-table"),d=(0,i.up)("q-card");return(0,i.wy)(((0,i.wg)(),(0,i.j4)("div",p,[(0,i.Wm)(d,{class:"fit"},{default:u((()=>[(0,i.Wm)(l,{onRowClick:a.clickRow,selected:a.selectedRows,"onUpdate:selected":t[1]||(t[1]=e=>a.selectedRows=e),rows:a.projectors,columns:a.columns,"row-key":"uId",class:e.$q.dark.isActive?"my-sticky-header-table-dark":"my-sticky-header-table",selection:"multiple",pagination:{rowsPerPage:100},"hide-bottom":"",dense:"",flat:"",bordered:"",square:""},{"body-cell":u((t=>{var o;return[(0,i.Wm)(h,{props:t,class:t.row.uId===(null===(o=a.selectedProjector)||void 0===o?void 0:o.uId)?e.$q.dark.isActive?"bg-grey-8":"bg-grey-4":""},{default:u((()=>{var e;return[t.row.uId===(null===(e=a.selectedProjector)||void 0===e?void 0:e.uId)?((0,i.wg)(),(0,i.j4)("span",_,(0,s.zw)(t.value),1)):((0,i.wg)(),(0,i.j4)("span",b,(0,s.zw)(t.value),1))]})),_:2},1032,["props","class"])]})),_:1},8,["onRowClick","selected","rows","columns","class"])])),_:1})],512)),[[n.F8,a.showProjectorDetail]])}));var S=o(11185),f=o(63898);const g={name:"Projector-Table",data(){return{}},computed:{unitLabel(){return this.$store.state.common.unitLabel},selectedRows:{get(){return this.$store.state.projector.selectedProjectors},set(e){this.SET_SELECTED_PROJECTORS(e)}},columns(){return[{name:"customName",required:!0,label:this.$t("customName"),field:"customName",align:"left"},{name:"modelName",required:!0,label:this.$t("modelName"),field:"modelName",align:"left"},{name:"lensName",required:!0,label:this.$t("lensName"),field:"lensName",align:"left",format:e=>`${e||"fixed"}`},{name:"x",required:!0,label:"x",field:"x",align:"left",format:e=>`${Number(e).toFixed(2)}m`},{name:"y",required:!0,label:"y",field:"y",align:"left",format:e=>`${Number(e).toFixed(2)}m`},{name:"z",required:!0,label:"z",field:"z",align:"left",format:e=>`${Number(e).toFixed(2)}m`},{name:"rotateX",required:!0,label:`${this.$t("rotateX")}(°)`,field:"rotateX",align:"left"},{name:"rotateY",required:!0,label:`${this.$t("rotateY")}(°)`,field:"rotateY",align:"left"},{name:"rotateZ",required:!0,label:`${this.$t("rotateZ")}(°)`,field:"rotateZ",align:"left"},{name:"throwRatio",required:!0,label:this.$t("throwRatio"),field:"throwRatio",align:"left"},{name:"lensShiftH",required:!0,label:`${this.$t("lensShiftH")}(%)`,field:"lensShiftH",align:"left"},{name:"lensShiftV",required:!0,label:`${this.$t("lensShiftV")}(%)`,field:"lensShiftV",align:"left"},{name:"brightnessOnScreenNit",required:!0,label:this.$t("brightnessOnScreenNit"),field:"brightnessOnScreenNit",align:"left"},{name:"ambientContrast",required:!0,label:this.$t("ambientContrast"),field:"ambientContrast",align:"left",format:e=>`${e}:1`}]},projectors(){return this.$store.state.projector.projectors},showProjectorDetail(){return this.$store.state.common.showProjectorDetail},selectedProjector(){return this.$store.getters["projector/selectedProjector"]}},watch:{selectedRows(){this.$bus.emit("updateShowDistanceHelper")}},methods:l()(l()({},(0,m.OI)("projector",["SET_SELECTED_PROJECTOR_UID","ADD_PROJECTOR","SET_SELECTED_PROJECTORS"])),{},{copyProjector(){const e=new f.u;Object.keys(this.selectedProjector).forEach((t=>{e[t]=this.selectedProjector[t]})),e.uId=(0,S.Z)(),e.customName=`${e.customName}(copy-${e.uId.slice(0,4)})`,this.ADD_PROJECTOR(e),this.$bus.emit("addProjector",e.uId)},clickRow(e,t,o){this.SET_SELECTED_PROJECTOR_UID(t.uId),this.$bus.emit("setProjector",t)}})};var w=o(10151),y=o(18468),P=o(83884),v=o(7518),R=o.n(v);g.render=j,g.__scopeId="data-v-4ff7e216";const x=g;R()(g,"components",{QCard:w.Z,QTable:y.Z,QTd:P.Z});o(10071);var z=o(55488),T=(o(60979),o(1118),o(12396),o(75691)),L=o(52483),E=o(65714),C=o(57742),O=o(45810),D=o(35389),I=o(29058),B=o(26017),M=o(52934),H=o(64750);class ${constructor(){this._renderer=null,this._labelRenderer=null,this._dom=null,this._camera=null,this._scene=null,this._light=null,this._gridHelper=null,this._axesX=null,this._axesY=null,this._axesZ=null,this._raycaster=new d.iMs,this._mouse=new d.FM8,this._hotProjectorUid="",this._currentHitPoint=new d.Pa4(0,0,0),this._currentHitDirection=new d.Pa4(0,0,0),this._isInterfere=!1,this._isShowDistanceRefrence=!1,this._isShowLightBound=!0,this._isShowDistanceHelper=!1,this._projectors=[],this._textures={},this._texture={wall:null,floor:null},this._room={material:{front:null,back:null,left:null,right:null,top:null,bottom:null},geometrys:{front:null,back:null,left:null,right:null,top:null,bottom:null},objects:{front:null,back:null,left:null,right:null,top:null,bottom:null}},this._roomSize={width:0,height:0,depth:0,widthDraw:0,heightDraw:0,depthDraw:0,ratio:10},this._screens=[{screenPosition:M.RM.front,screenType:M.jT.plane,screenObject:{material:null,geometry:null,object:null},planeScreen:{diagonal:0,aspectRatio:0},curvedScreen:{diagonal:0,aspectRatio:0,radius:0,radialSegments:3,isSmooth:!0},sphereScreen:{radius:0,phiStart:0,phiLength:100},customScreen:{geometry:"",material:""}},{screenPosition:M.RM.left,screenType:M.jT.none,screenObject:{material:null,geometry:null,object:null},planeScreen:{diagonal:0,aspectRatio:0},curvedScreen:{diagonal:0,aspectRatio:0,radius:0,radialSegments:3,isSmooth:!0},sphereScreen:{radius:0,phiStart:0,phiLength:100},customScreen:{geometry:"",material:""}},{screenPosition:M.RM.right,screenType:M.jT.none,screenObject:{material:null,geometry:null,object:null},planeScreen:{diagonal:0,aspectRatio:0},curvedScreen:{diagonal:0,aspectRatio:0,radius:0,radialSegments:3,isSmooth:!0},sphereScreen:{radius:0,phiStart:0,phiLength:100},customScreen:{geometry:"",material:""}},{screenPosition:M.RM.back,screenType:M.jT.none,screenObject:{material:null,geometry:null,object:null},planeScreen:{diagonal:0,aspectRatio:0},curvedScreen:{diagonal:0,aspectRatio:0,radius:0,radialSegments:3,isSmooth:!0},sphereScreen:{radius:0,phiStart:0,phiLength:100},customScreen:{geometry:"",material:""}},{screenPosition:M.RM.top,screenType:M.jT.none,screenObject:{material:null,geometry:null,object:null},planeScreen:{diagonal:0,aspectRatio:0},curvedScreen:{diagonal:0,aspectRatio:0,radius:0,radialSegments:3,isSmooth:!0},sphereScreen:{radius:0,phiStart:0,phiLength:100},customScreen:{geometry:"",material:""}},{screenPosition:M.RM.bottom,screenType:M.jT.none,screenObject:{material:null,geometry:null,object:null},planeScreen:{diagonal:0,aspectRatio:0},curvedScreen:{diagonal:0,aspectRatio:0,radius:0,radialSegments:3,isSmooth:!0},sphereScreen:{radius:0,phiStart:0,phiLength:100},customScreen:{geometry:"",material:""}}],this._controls=null}_initRenderer(e){d.CtF.enabled=!0,this._dom=document.querySelector(e);const t=this._dom.getBoundingClientRect();this._renderer=new d.CP7({antialias:!0}),this._dom.appendChild(this._renderer.domElement),this._renderer.setSize(t.width,t.height+20),this._labelRenderer=new E.M,this._dom.appendChild(this._labelRenderer.domElement),this._labelRenderer.setSize(t.width,t.height+20),this._labelRenderer.domElement.style.position="absolute",this._labelRenderer.domElement.style.top="0px",this._initCamera(t),this._dom.addEventListener("mousemove",(e=>{this._onMouseMove(e)}),!1),this._dom.addEventListener("mousedown",(()=>{this._onMouseDown()}),!1)}onWindowResize(){const e=this._dom.getBoundingClientRect();this._camera.aspect=e.width/e.height,this._camera.updateProjectionMatrix(),this._renderer.setSize(e.width,e.height),this._labelRenderer.setSize(e.width,e.height)}_onMouseMove(e){const t=this._dom.getBoundingClientRect();this._mouse.x=e.offsetX/t.width*2-1,this._mouse.y=-e.offsetY/t.height*2+1}_onMouseDown(){this._hotProjectorUid&&(z.default.commit("projector/SET_SELECTED_PROJECTOR_UID",this._hotProjectorUid),this._setTransformControl(this._hotProjectorUid),this._createAllBoundLine())}_setTransformControl(e){const t=this._projectors.find((t=>t.name===e));this._transformControl.object!==t&&this._transformControl.attach(t)}_initCamera(e){this._camera=new d.cPb(40,e.width/e.height,.1,1e3)}_initScene(){this._scene=new d.xsS;const e=1e3,t=100;this._gridHelper=new d.VLJ(e,t),this._initRoomSize(),this._initAxes(),this._initLight(),this.setTheme()}_initAxes(){const e=new d.Pa4(.1,.1,.1),t=new d.Pa4(1,0,0),o=new d.Pa4(0,1,0),i=new d.Pa4(0,0,1),s=16711680,n=65280,r=255,c=15;this._axesX=new d.tGC(t,e,c,s),this._axesY=new d.tGC(o,e,c,n),this._axesZ=new d.tGC(i,e,c,r),this._scene.add(this._axesX),this._scene.add(this._axesY),this._scene.add(this._axesZ);const a=document.createElement("div");a.className="mps-three-label axex-refer",a.textContent="X",a.style="background-color:transparent;color:red;font-weight:bold";const h=new E.j(a);h.position.set(15,0,0),this._scene.add(h);const l=document.createElement("div");l.className="mps-three-label axex-refer",l.style="background-color:transparent;color:green;font-weight:bold",l.textContent="Y";const m=new E.j(l);m.position.set(0,15,0),this._scene.add(m);const u=document.createElement("div");u.className="mps-three-label axex-refer",u.style="background-color:transparent;color:blue;font-weight:bold",u.textContent="Z";const p=new E.j(u);p.position.set(0,0,15),this._scene.add(p)}_initLight(){this._light?this._light.position.set(this._roomSize.widthDraw/2,this._roomSize.heightDraw,this._roomSize.depthDraw/2):(this._light=new d.cek(16777215,1,0,2),this._light.position.set(this._roomSize.widthDraw/2,this._roomSize.heightDraw,this._roomSize.depthDraw/2),this._scene.add(this._light))}_initControls(){this._controls=new T.z(this._camera,this._labelRenderer.domElement),this._camera.position.set(93.00186725385036,47.36734865791704,227.17171251812294),this._camera.lookAt(0,0,0),this._controls.addEventListener("change",(()=>{}))}_initTransformControl(){this._transformControl=new L.Ys(this._camera,this._labelRenderer.domElement),this._transformControl.size=.5,this._transformControl.addEventListener("dragging-changed",(e=>{this._controls.enabled=!e.value;const t=this._transformControl.object;if(!t.historyPoints&&(t.historyPoints=[]),t.historyPoints.length>0){const e=t.historyPoints[t.historyPoints.length-1];if(e.x===t.position.x&&e.y===t.position.y&&e.z===t.position.z)return}t.historyIndex&&t.historyIndex!==t.historyPoints.length-1&&t.historyPoints.splice(t.historyIndex),t.historyPoints.push({x:t.position.x,y:t.position.y,z:t.position.z}),t.historyIndex=t.historyPoints.length-1,t&&this._analyzeUndoRedo(t)}));let e=0;this._transformControl.addEventListener("change",(t=>{var o,i,s;(e++,e%2===0&&this._transformControl.object)&&(z.default.commit("projector/SET_SELECTED_PROJECTOR_X",(null===(o=this._transformControl.object.position)||void 0===o?void 0:o.x)/this._roomSize.ratio),z.default.commit("projector/SET_SELECTED_PROJECTOR_Y",(null===(i=this._transformControl.object.position)||void 0===i?void 0:i.y)/this._roomSize.ratio),z.default.commit("projector/SET_SELECTED_PROJECTOR_Z",(null===(s=this._transformControl.object.position)||void 0===s?void 0:s.z)/this._roomSize.ratio),this._isInterfere&&this._analyzeInterfere(),this._createBoundLine(this._transformControl.object.name))})),this._scene.add(this._transformControl)}_render(){this._raycaster.setFromCamera(this._mouse,this._camera),this._hotProjectorUid=null,this._projectors.forEach((e=>{const t=this._raycaster.intersectObjects(e.children);t.length>0?e.children.forEach((t=>{t.material&&(t.material.emissive.setHex(255),this._hotProjectorUid=e.name)})):e.children.forEach((t=>{t.material&&((e.isProjectorInterfere||e.isProjectionInterfere)&&this._isInterfere?t.material.emissive.setHex(16711680):t.material.emissive.setHex(0))}))})),this._hotProjectorUid&&!z.default.state.common.isToShowContextmenu?z.default.commit("common/SET_IS_TO_SHOW_CONTEXTMENU",!0):!this._hotProjectorUid&&z.default.state.common.isToShowContextmenu&&z.default.commit("common/SET_IS_TO_SHOW_CONTEXTMENU",!1),this._renderer.render(this._scene,this._camera),this._labelRenderer.render(this._scene,this._camera)}setTheme(){this._scene.background=I.Z.isActive?new d.Ilk(13223865):new d.Ilk(16252911)}animate(){requestAnimationFrame((()=>{this.animate()})),this._render()}_initTexture(){const e=new d.dpR,t=new Promise(((t,o)=>{e.load("texture/wall_grey.jfif",(e=>{const o=new d.YBo({map:e,side:d.Wl3,emissive:16711422,emissiveIntensity:.2});this._room.material.front=o,this._room.material.back=o,this._room.material.left=o,this._room.material.right=o,this._room.material.top=o,t(e)}),null,(e=>{o(e)}))})),o=new Promise(((t,o)=>{e.load("texture/floor_grey.jfif",(e=>{const o=new d.YBo({map:e,side:d.Wl3,emissive:16711422,emissiveIntensity:.2});this._room.material.bottom=o,t(e)}),null,(e=>{o(e)}))})),i=new Promise(((t,o)=>{e.load("texture/screen.jfif",(e=>{const o=new d.vBJ({map:e,side:d.ehD,transparent:!0,opacity:.8});this._screens.forEach((e=>{e.screenObject.material=o})),t(e)}),null,(e=>{o(e)}))}));return Promise.all([t,o,i])}_loadTexture(e,t){const o=new d.dpR;return new Promise(((i,s)=>{if(t){const t=document.createElement("video");t.src=e,t.style.width="0px",t.autoplay=!0,t.muted=!0,t.loop=!0,t.controls=!0;const o=document.getElementById("textureVideo");o.appendChild(t);const s=new d.fO1(t);i(s)}else o.load(e,(e=>{i(e)}),null,(e=>{s(e)}))}))}_initRoomSize(){this._roomSize.width=z.default.state.room.width,this._roomSize.height=z.default.state.room.height,this._roomSize.depth=z.default.state.room.depth,this._roomSize.widthDraw=this._roomSize.width*this._roomSize.ratio,this._roomSize.heightDraw=this._roomSize.height*this._roomSize.ratio,this._roomSize.depthDraw=this._roomSize.depth*this._roomSize.ratio}_initRoom(){this._room&&(Object.values(this._room.geometrys).forEach((e=>{e&&e.dispose()})),Object.values(this._room.objects).forEach((e=>{e&&this._scene.remove(e)}))),this._initRoomSize(),this._room.geometrys.front=new d._12(this._roomSize.widthDraw,this._roomSize.heightDraw),this._room.objects.front=new d.Kj0(this._room.geometrys.front,this._room.material.front),this._room.objects.front.position.x=this._roomSize.widthDraw/2,this._room.objects.front.position.z=this._roomSize.depthDraw,this._room.objects.front.position.y=this._roomSize.heightDraw/2,this._room.objects.front.rotateY(1*Math.PI),this._scene.add(this._room.objects.front),this._room.geometrys.back=new d._12(this._roomSize.widthDraw,this._roomSize.heightDraw),this._room.objects.back=new d.Kj0(this._room.geometrys.back,this._room.material.back),this._room.objects.back.position.x=this._roomSize.widthDraw/2,this._room.objects.back.position.y=this._roomSize.heightDraw/2,this._scene.add(this._room.objects.back),this._room.geometrys.top=new d._12(this._roomSize.widthDraw,this._roomSize.depthDraw),this._room.objects.top=new d.Kj0(this._room.geometrys.top,this._room.material.top),this._room.objects.top.position.x=this._roomSize.widthDraw/2,this._room.objects.top.position.y=this._roomSize.heightDraw,this._room.objects.top.position.z=this._roomSize.depthDraw/2,this._room.objects.top.rotateX(.5*Math.PI),this._scene.add(this._room.objects.top),this._room.geometrys.bottom=new d._12(this._roomSize.widthDraw,this._roomSize.depthDraw),this._room.objects.bottom=new d.Kj0(this._room.geometrys.bottom,this._room.material.bottom),this._room.objects.bottom.position.x=this._roomSize.widthDraw/2,this._room.objects.bottom.position.z=this._roomSize.depthDraw/2,this._room.objects.bottom.rotateX(-.5*Math.PI),this._scene.add(this._room.objects.bottom),this._room.geometrys.left=new d._12(this._roomSize.depthDraw,this._roomSize.heightDraw),this._room.objects.left=new d.Kj0(this._room.geometrys.left,this._room.material.left),this._room.objects.left.position.x=this._roomSize.widthDraw,this._room.objects.left.position.y=this._roomSize.heightDraw/2,this._room.objects.left.position.z=this._roomSize.depthDraw/2,this._room.objects.left.rotateY(-.5*Math.PI),this._scene.add(this._room.objects.left),this._room.geometrys.right=new d._12(this._roomSize.depthDraw,this._roomSize.heightDraw),this._room.objects.right=new d.Kj0(this._room.geometrys.right,this._room.material.right),this._room.objects.right.position.x=0,this._room.objects.right.position.y=this._roomSize.heightDraw/2,this._room.objects.right.position.z=this._roomSize.depthDraw/2,this._room.objects.right.rotateY(.5*Math.PI),this._scene.add(this._room.objects.right)}_initScreen(e){e?(e.screenObject.geometry&&e.screenObject.geometry.dispose(),e.screenObject.object&&this._scene.remove(e.screenObject.object),e.screenType===M.jT.plane&&this._createPlaneScreen(e),e.screenType===M.jT.curved&&this._createCurveScreen(e),e.screenType===M.jT.sphere&&this._createSphereScreen(e),e.screenType===M.jT.custom&&this._createCustomScreen(e),this.adjustScreenPosition(e)):(this._screens.forEach((e=>{e.screenObject.geometry&&e.screenObject.geometry.dispose(),e.screenObject.object&&this._scene.remove(e.screenObject.object),e.screenType===M.jT.plane&&this._createPlaneScreen(e),e.screenType===M.jT.curved&&this._createCurveScreen(e),e.screenType===M.jT.sphere&&this._createSphereScreen(e),e.screenType===M.jT.custom&&this._createCustomScreen(e),z.default.commit("screen/SET_SCREEN_POSTION",e.screenPosition),this.adjustScreenPosition(e)})),z.default.commit("screen/SET_SCREEN_POSTION",M.RM.front))}adjustScreenPosition(e){if(e||(e=this._screens[z.default.state.screen.screenPosition]),e.screenType===M.jT.none)return;const t=e.screenObject.geometry.attributes.position.array,o=e.screenObject.geometry.attributes.position.count;let i=0,s=0,n=0,r=0,c=0,a=0;for(let h=0;h<o;h++){const[e,o,l]=[t[3*h],t[3*h+1],t[3*h+2]];e<i&&(i=e),e>s&&(s=e),o<n&&(n=o),o>r&&(r=o),l>c&&(c=l),l<a&&(a=l)}e.screenPosition===M.RM.front?(e.screenObject.object.position.x=this._roomSize.widthDraw/2,e.screenObject.object.position.y=this._roomSize.heightDraw/2,e.screenObject.object.position.z=1*this._roomSize.ratio-a):e.screenPosition===M.RM.left?(e.screenObject.object.position.x=.5*this._roomSize.ratio-a,e.screenObject.object.position.y=this._roomSize.heightDraw/2,e.screenObject.object.position.z=this._roomSize.depthDraw/2):e.screenPosition===M.RM.right?(e.screenObject.object.position.x=this._roomSize.widthDraw+a-.5*this._roomSize.ratio,e.screenObject.object.position.y=this._roomSize.heightDraw/2,e.screenObject.object.position.z=this._roomSize.depthDraw/2):e.screenPosition===M.RM.back?(e.screenObject.object.position.x=this._roomSize.widthDraw/2,e.screenObject.object.position.y=this._roomSize.heightDraw/2,e.screenObject.object.position.z=this._roomSize.depthDraw+a-1*this._roomSize.ratio):e.screenPosition===M.RM.top?(e.screenObject.object.position.x=this._roomSize.widthDraw/2,e.screenObject.object.position.y=this._roomSize.heightDraw+a-.5*this._roomSize.ratio,e.screenObject.object.position.z=this._roomSize.depthDraw/2):e.screenPosition===M.RM.bottom&&(e.screenObject.object.position.x=this._roomSize.widthDraw/2,e.screenObject.object.position.y=.5*this._roomSize.ratio-a,e.screenObject.object.position.z=this._roomSize.depthDraw/2),z.default.commit("screen/SET_X",e.screenObject.object.position.x/this._roomSize.ratio),z.default.commit("screen/SET_Y",e.screenObject.object.position.y/this._roomSize.ratio),z.default.commit("screen/SET_Z",e.screenObject.object.position.z/this._roomSize.ratio),z.default.commit("screen/SET_ROTATE_X",e.screenObject.object.rotation.x/Math.PI*180),z.default.commit("screen/SET_ROTATE_Y",e.screenObject.object.rotation.y/Math.PI*180),z.default.commit("screen/SET_ROTATE_Z",e.screenObject.object.rotation.z/Math.PI*180),e.screenObject.object.updateMatrixWorld(),this._createAllBoundLine()}_createPlaneScreen(e){const t=z.default.state.screen.screens[e.screenPosition];e.planeScreen.diagonal=t.plane.diagonal,e.planeScreen.aspectRatio=t.plane.aspectRatio,0===e.planeScreen.aspectRatio&&(e.planeScreen.aspectRatio=t.plane.width/t.plane.height);const o=e.planeScreen.diagonal/M.OO.inch,i=Math.atan(e.planeScreen.aspectRatio),s=o*Math.sin(i),n=s/e.planeScreen.aspectRatio;e.screenObject.geometry=new d._12(s*this._roomSize.ratio,n*this._roomSize.ratio),e.screenObject.object=new d.Kj0(e.screenObject.geometry,e.screenObject.material),e.screenPosition===M.RM.left?e.screenObject.object.rotation.y=.5*Math.PI:e.screenPosition===M.RM.right?e.screenObject.object.rotation.y=1.5*Math.PI:e.screenPosition===M.RM.back?e.screenObject.object.rotation.y=Math.PI:e.screenPosition===M.RM.top?e.screenObject.object.rotation.x=.5*Math.PI:e.screenPosition===M.RM.bottom&&(e.screenObject.object.rotation.x=1.5*Math.PI),this._scene.add(e.screenObject.object)}_createCurveScreen(e){const t=z.default.state.screen.screens[e.screenPosition];e.curvedScreen.diagonal=t.curved.diagonal,e.curvedScreen.aspectRatio=t.curved.aspectRatio,e.curvedScreen.radius=t.curved.radius*this._roomSize.ratio,e.curvedScreen.radialSegments=t.curved.radialSegments,e.curvedScreen.isSmooth=t.curved.isSmooth,0===e.curvedScreen.aspectRatio&&(e.curvedScreen.aspectRatio=t.curved.width/t.curved.height);const o=e.curvedScreen.diagonal/M.OO.inch,i=Math.atan(e.curvedScreen.aspectRatio),s=o*Math.sin(i),n=s/e.curvedScreen.aspectRatio,r=s*this._roomSize.ratio/e.curvedScreen.radius;e.screenObject.geometry=new d.fHI(e.curvedScreen.radius,e.curvedScreen.radius,n*this._roomSize.ratio,e.curvedScreen.isSmooth?128:e.curvedScreen.radialSegments,1,!0,Math.PI-r/2,r),e.screenObject.object=new d.Kj0(e.screenObject.geometry,e.screenObject.material),e.screenPosition===M.RM.left?e.screenObject.object.rotation.y=.5*Math.PI:e.screenPosition===M.RM.right?e.screenObject.object.rotation.y=1.5*Math.PI:e.screenPosition===M.RM.back?e.screenObject.object.rotation.y=Math.PI:e.screenPosition===M.RM.top?e.screenObject.object.rotation.x=.5*Math.PI:e.screenPosition===M.RM.bottom&&(e.screenObject.object.rotation.x=1.5*Math.PI),this._scene.add(e.screenObject.object)}_createSphereScreen(e){const t=z.default.state.screen.screens[e.screenPosition];e.sphereScreen.radius=t.sphere.radius*this._roomSize.ratio,e.sphereScreen.phiStart=Math.PI+t.sphere.phiStart/180*Math.PI,e.sphereScreen.phiLength=t.sphere.phiLength/180*Math.PI,e.sphereScreen.thetaStart=t.sphere.thetaStart/180*Math.PI,e.sphereScreen.thetaLength=(1-t.sphere.thetaEnd/180-t.sphere.thetaStart/180)*Math.PI,e.screenObject.geometry=new d.xo$(e.sphereScreen.radius,16,16,e.sphereScreen.phiStart,e.sphereScreen.phiLength,e.sphereScreen.thetaStart,e.sphereScreen.thetaLength),e.screenObject.object=new d.Kj0(e.screenObject.geometry,e.screenObject.material),e.screenPosition===M.RM.left?e.screenObject.object.rotation.y=.5*Math.PI:e.screenPosition===M.RM.right?e.screenObject.object.rotation.y=1.5*Math.PI:e.screenPosition===M.RM.back?e.screenObject.object.rotation.y=Math.PI:e.screenPosition===M.RM.top?e.screenObject.object.rotation.x=.5*Math.PI:e.screenPosition===M.RM.bottom&&(e.screenObject.object.rotation.x=1.5*Math.PI),this._scene.add(e.screenObject.object)}_createCustomScreen(e){const t=z.default.state.screen.screens[e.screenPosition],o=t.custom.geometrySrc,i=t.custom.materialSrc;if(""===o)return void(e.screenObject.object=new d.Kj0);const s=new O.v,n=new C.L;s.loadAsync(i).then((t=>{n.setMaterials(t),n.loadAsync(o).then((t=>{t.children.forEach((e=>{e.geometry.computeBoundingBox(),e.geometry.center()})),t.isScreen=!0,e.screenObject.object=t,this._scene.add(t),this.adjustScreenPosition(e)}))}))}_addProjector(e){const t=new O.v,o=new C.L,i=new Promise(((i,s)=>{t.load("models/H7T_Laset7.mtl",(t=>{o.setMaterials(t),o.load("models/H7T_Laset7.obj",(t=>{t.children.forEach((e=>{e.geometry.computeBoundingBox(),e.geometry.center()})),t.name=e,t.position.x=this._roomSize.widthDraw/2,t.position.y=this._roomSize.heightDraw/2,t.position.z=this._roomSize.depthDraw/2,t.rotation.y=Math.PI;const o=document.createElement("div");o.className="mps-three-label",o.id=e,o.textContent=z.default.state.projector.projectors.find((t=>t.uId===e)).customName;const s=new E.j(o);s.position.set(0,3,0),t.add(s),this._scene.add(t),this._transformControl.attach(t),i(t)}),void 0,(e=>{s(e)}))}),void 0,(e=>{s(e)}))}));return i}_disposeBoundLine(e){var t,o,i,s,n,r,c,a,h,l,d,m,u,p,_,b,j,S,f,g,w,y,P,v,R,x,z,T,L,E,C,O,D,I,B,M,H,$,k,A,Z,G,N,W,X,Y,q,U,F,J,V,Q,K,ee;const te=this._projectors.find((t=>t.name===e));(null===(t=te.lightBoundLT)||void 0===t?void 0:t.geometry)&&(null===(o=te.lightBoundLT)||void 0===o||o.geometry.dispose()),(null===(i=te.lightBoundLT)||void 0===i?void 0:i.object)&&this._scene.remove(null===(s=te.lightBoundLT)||void 0===s?void 0:s.object),(null===(n=te.lightBoundRT)||void 0===n?void 0:n.geometry)&&(null===(r=te.lightBoundRT)||void 0===r||r.geometry.dispose()),(null===(c=te.lightBoundRT)||void 0===c?void 0:c.object)&&this._scene.remove(null===(a=te.lightBoundRT)||void 0===a?void 0:a.object),(null===(h=te.lightBoundLB)||void 0===h?void 0:h.geometry)&&(null===(l=te.lightBoundLB)||void 0===l||l.geometry.dispose()),(null===(d=te.lightBoundLB)||void 0===d?void 0:d.object)&&this._scene.remove(null===(m=te.lightBoundLB)||void 0===m?void 0:m.object),(null===(u=te.lightBoundRB)||void 0===u?void 0:u.geometry)&&(null===(p=te.lightBoundRB)||void 0===p||p.geometry.dispose()),(null===(_=te.lightBoundRB)||void 0===_?void 0:_.object)&&this._scene.remove(null===(b=te.lightBoundRB)||void 0===b?void 0:b.object),(null===(j=te.screenBoundL)||void 0===j?void 0:j.geometry)&&(null===(S=te.screenBoundL)||void 0===S||S.geometry.dispose()),(null===(f=te.screenBoundL)||void 0===f?void 0:f.object)&&this._scene.remove(null===(g=te.screenBoundL)||void 0===g?void 0:g.object),(null===(w=te.screenBoundR)||void 0===w?void 0:w.geometry)&&(null===(y=te.screenBoundR)||void 0===y||y.geometry.dispose()),(null===(P=te.screenBoundR)||void 0===P?void 0:P.object)&&this._scene.remove(null===(v=te.screenBoundR)||void 0===v?void 0:v.object),(null===(R=te.screenBoundT)||void 0===R?void 0:R.geometry)&&(null===(x=te.screenBoundT)||void 0===x||x.geometry.dispose()),(null===(z=te.screenBoundT)||void 0===z?void 0:z.object)&&this._scene.remove(null===(T=te.screenBoundT)||void 0===T?void 0:T.object),(null===(L=te.screenBoundB)||void 0===L?void 0:L.geometry)&&(null===(E=te.screenBoundB)||void 0===E||E.geometry.dispose()),(null===(C=te.screenBoundB)||void 0===C?void 0:C.object)&&this._scene.remove(null===(O=te.screenBoundB)||void 0===O?void 0:O.object),(null===(D=te.blendingGuideLineL)||void 0===D?void 0:D.geometry)&&(null===(I=te.blendingGuideLineL)||void 0===I||I.geometry.dispose()),(null===(B=te.blendingGuideLineL)||void 0===B?void 0:B.object)&&this._scene.remove(null===(M=te.blendingGuideLineL)||void 0===M?void 0:M.object),(null===(H=te.blendingGuideLineR)||void 0===H?void 0:H.geometry)&&(null===($=te.blendingGuideLineR)||void 0===$||$.geometry.dispose()),(null===(k=te.blendingGuideLineR)||void 0===k?void 0:k.object)&&this._scene.remove(null===(A=te.blendingGuideLineR)||void 0===A?void 0:A.object),(null===(Z=te.blendingGuideLineT)||void 0===Z?void 0:Z.geometry)&&(null===(G=te.blendingGuideLineT)||void 0===G||G.geometry.dispose()),(null===(N=te.blendingGuideLineT)||void 0===N?void 0:N.object)&&this._scene.remove(null===(W=te.blendingGuideLineT)||void 0===W?void 0:W.object),(null===(X=te.blendingGuideLineB)||void 0===X?void 0:X.geometry)&&(null===(Y=te.blendingGuideLineB)||void 0===Y||Y.geometry.dispose()),(null===(q=te.blendingGuideLineB)||void 0===q?void 0:q.object)&&this._scene.remove(null===(U=te.blendingGuideLineB)||void 0===U?void 0:U.object),(null===(F=te.screenPlane)||void 0===F?void 0:F.geometry)&&(null===(J=te.screenPlane)||void 0===J||J.geometry.dispose()),(null===(V=te.screenPlane)||void 0===V?void 0:V.object)&&this._scene.remove(null===(Q=te.screenPlane)||void 0===Q?void 0:Q.object),(null===(K=te.screenPlane)||void 0===K?void 0:K.label)&&this._scene.remove(null===(ee=te.screenPlane)||void 0===ee?void 0:ee.label)}_createBoundLine(e){const t=this._projectors.find((t=>t.name===e)),o=z.default.state.projector.projectors.find((t=>t.uId===e)),i=z.default.state.projector.selectedProjectorUid===e;if(!t||!o)return;this._disposeBoundLine(e);const s=1/o.throwRatio/o.aspectRatio/2,n=1+(2*o.lensShiftV+o.offset)/100,r=180*Math.atan(s*n)/Math.PI,c=1-(2*o.lensShiftV+o.offset)/100,a=180*Math.atan(s*c)/Math.PI,h=1/o.throwRatio/2,l=1+2*o.lensShiftH/100,m=180*Math.atan(h*l)/Math.PI,u=1-2*o.lensShiftH/100,p=180*Math.atan(h*u)/Math.PI,_=(r-a)/2,b=(p-m)/2,j=new d.Pa4;j.set(Math.tan(p*Math.PI/180),Math.tan(r*Math.PI/180),1);const S=j.clone();this._applayDirectionRotation(j,o);const f=new d.Pa4;f.set(-Math.tan(m*Math.PI/180),Math.tan(r*Math.PI/180),1);const g=f.clone();this._applayDirectionRotation(f,o);const w=new d.Pa4;w.set(Math.tan(p*Math.PI/180),-Math.tan(a*Math.PI/180),1);const y=w.clone();this._applayDirectionRotation(w,o);const P=new d.Pa4;P.set(-Math.tan(m*Math.PI/180),-Math.tan(a*Math.PI/180),1);const v=P.clone();this._applayDirectionRotation(P,o);const R=new d.Pa4;R.set(Math.tan(b*Math.PI/180),Math.tan(_*Math.PI/180),1),this._applayDirectionRotation(R,o),t.lightBoundLT=this._createRayLine(t.position,j,i),t.lightBoundRT=this._createRayLine(t.position,f,i),t.lightBoundLB=this._createRayLine(t.position,w,i),t.lightBoundRB=this._createRayLine(t.position,P,i);const x=this._calcHitDistance(t.position,R)/this._roomSize.ratio;if(z.default.commit("projector/SET_SELECTED_PROJECTOR_PROJECTION_DISTANCE",x),t.directionCenter=R,t.projectionDistance=x,z.default.commit("projector/SET_SELECTED_PROJECTOR_AMBITENT_CONTRAST",(0,H.gh)(e)),z.default.commit("projector/SET_SELECTED_PROJECTOR_BRIGHTNESS_NIT",(0,H.vc)(e)),t.screenBoundL=this._createScreenBoundLine(t.position,S,y,"y",o,i),t.screenBoundR=this._createScreenBoundLine(t.position,g,v,"y",o,i),t.screenBoundT=this._createScreenBoundLine(t.position,S,g,"x",o,i),t.screenBoundB=this._createScreenBoundLine(t.position,y,v,"x",o,i),this._isShowDistanceRefrence&&(x>=o.minDistance&&x<=o.maxDistance||(t.screenBoundL.object.material.color.r=1,t.screenBoundR.object.material.color.r=1,t.screenBoundT.object.material.color.r=1,t.screenBoundB.object.material.color.r=1,t.lightBoundLT.object.material.color.r=1,t.lightBoundRT.object.material.color.r=1,t.lightBoundLB.object.material.color.r=1,t.lightBoundRB.object.material.color.r=1)),o.isShowBlendingGuideLine){const e=S.clone(),s=g.clone(),n=y.clone(),r=v.clone(),c=(s.x-e.x)*o.blendingGuideLineL/100/2,a=(s.x-e.x)*o.blendingGuideLineR/100/2,h=(n.y-e.y)*o.blendingGuideLineT/100/2,l=(n.y-e.y)*o.blendingGuideLineB/100/2;e.x+=c,e.y+=h,s.x-=a,s.y+=h,n.x+=c,n.y-=l,r.x-=a,r.y-=l,t.blendingGuideLineL=this._createBlendingGuideLine(t.position,e,n,"y",o,i),t.blendingGuideLineR=this._createBlendingGuideLine(t.position,s,r,"y",o,i),t.blendingGuideLineT=this._createBlendingGuideLine(t.position,e,s,"x",o,i),t.blendingGuideLineB=this._createBlendingGuideLine(t.position,n,r,"x",o,i)}t.screenPlane=this._createScreenPlane(t.position,S,y,v,o,i),this._createDistanceHelper(t,o),this._createProjectionSize(t,o,R)}_analyzeInterfere(){this._projectors.forEach((e=>{e.isProjectionInterfere=!1;let t=!1;this._projectors.forEach((o=>{o.name!==e.name&&Math.abs(o.position.x-e.position.x)<5&&Math.abs(o.position.y-e.position.y)<2&&Math.abs(o.position.z-e.position.z)<5&&(t=!0)})),e.isProjectorInterfere=t}))}_applayDirectionRotation(e,t){const o=new d.Pa4(1,0,0),i=new d.Pa4(0,1,0),s=new d.Pa4(0,0,1);e.applyAxisAngle(o,t.rotateX/180*Math.PI),e.applyAxisAngle(i,Math.PI+t.rotateY/180*Math.PI),e.applyAxisAngle(s,t.rotateZ/180*Math.PI)}_createScreenBoundLine(e,t,o,i,s,n){const r=this._calcDivideCutPoints(e,t,o,i,s),c={geometry:null,object:null};c.geometry=new D.VJ,c.geometry.setPoints(r);const a=new D.r7({color:8947848,lineWidth:.4,transparent:!n,opacity:.6});return c.object=new d.Kj0(c.geometry,a),this._scene.add(c.object),c}_createBlendingGuideLine(e,t,o,i,s,n){const r=this._calcDivideCutPoints(e,t,o,i,s),c={geometry:null,object:null};c.geometry=new D.VJ,c.geometry.setPoints(r);const a=new D.r7({color:255,lineWidth:.4,transparent:!n,opacity:.6});return c.object=new d.Kj0(c.geometry,a),this._scene.add(c.object),c}_createScreenPlane(e,t,o,i,s,n){if(s.imageAspectRatio>s.aspectRatio){const e=(s.imageAspectRatio-s.aspectRatio)/s.imageAspectRatio*(t.y-o.y);t.y-=e/2,o.y+=e/2}else if(s.imageAspectRatio<s.aspectRatio){const e=(s.aspectRatio-s.imageAspectRatio)/s.aspectRatio*(o.x-i.x);o.x-=e/2,i.x+=e/2}const r=30,c=[],a=[],h=[],l=[],m=(t.y-o.y)/r;for(let d=0;d<=r;d++){const t=o.clone();t.y+=m*d;const n=i.clone();n.y+=m*d,l[d]=this._calcDivideCutPoints(e,t,n,"x",s)}for(let d=0;d<l.length;d++)for(let e=0;e<l[d].length;e++)if(l[d+1]&&l[d][e+1]){c.push(l[d][e].x),c.push(l[d][e].y),c.push(l[d][e].z),c.push(l[d+1][e].x),c.push(l[d+1][e].y),c.push(l[d+1][e].z),c.push(l[d+1][e+1].x),c.push(l[d+1][e+1].y),c.push(l[d+1][e+1].z),h.push(e/r),h.push(d/r),h.push(e/r),h.push((d+1)/r),h.push((e+1)/r),h.push((d+1)/r),c.push(l[d][e].x),c.push(l[d][e].y),c.push(l[d][e].z),c.push(l[d+1][e+1].x),c.push(l[d+1][e+1].y),c.push(l[d+1][e+1].z),c.push(l[d][e+1].x),c.push(l[d][e+1].y),c.push(l[d][e+1].z),h.push(e/r),h.push(d/r),h.push((e+1)/r),h.push((d+1)/r),h.push((e+1)/r),h.push(d/r);for(let e=0;e<6;e++)a.push(0),a.push(0),a.push(1)}const u={geometry:null,object:null,label:null};u.geometry=new d.u9r;const p=new Float32Array(c),_=new Float32Array(a),b=new Float32Array(h);u.geometry.setAttribute("position",new d.TlE(p,3)),u.geometry.setAttribute("normal",new d.TlE(_,3)),u.geometry.setAttribute("uv",new d.TlE(b,2));const j=new d.vBJ({side:d.ehD,transparent:!0,opacity:n?1:.6,color:16776415,blending:d.bdR});return j.map=this._textures[s.texture],u.object=new d.Kj0(u.geometry,j),this._scene.add(u.object),u}_createDistanceHelper(e,t){this._disposeDistanceHelperObject(e);const o=z.default.state.projector.selectedProjectors.findIndex((t=>t.uId===e.name))>=0;if(this._isShowDistanceHelper&&o){const o=new d.Pa4(-1,0,0),i=new d.Pa4(1,0,0),s=new d.Pa4(0,1,0),n=new d.Pa4(0,-1,0),r=new d.Pa4(0,0,1),c=new d.Pa4(0,0,-1);!e.distanceHelperColor&&(e.distanceHelperColor=(0,H.p)());const a=(0,B.Z)(!0,{},e.position);a.x/=2,e.distanceHelperXLeft=new d.tGC(o,a,e.position.x/2,e.distanceHelperColor),e.distanceHelperXRight=new d.tGC(i,a,e.position.x/2,e.distanceHelperColor);const h=(0,B.Z)(!0,{},e.position);h.y/=2,e.distanceHelperYTop=new d.tGC(s,h,e.position.y/2,e.distanceHelperColor),e.distanceHelperYBottom=new d.tGC(n,h,e.position.y/2,e.distanceHelperColor);const l=(0,B.Z)(!0,{},e.position);if(l.z/=2,e.distanceHelperZFront=new d.tGC(r,l,e.position.z/2,e.distanceHelperColor),e.distanceHelperZBack=new d.tGC(c,l,e.position.z/2,e.distanceHelperColor),e.distanceHelperXLabel){e.distanceHelperXLabel.position.set(a.x,a.y+2,a.z-2);const o=document.getElementById(`distance-helper-x-${e.name}`);o.textContent=(t.x*z.default.state.common.unitRatio).toFixed(2)}else{const o=document.createElement("div");o.className="mps-three-label",o.id=`distance-helper-x-${e.name}`,o.textContent=(t.x*z.default.state.common.unitRatio).toFixed(2),o.style=`background-color:transparent;color:${e.distanceHelperColor};font-weight:bold;font-size:20px`,e.distanceHelperXLabel=new E.j(o),e.distanceHelperXLabel.position.set(a.x,a.y+2,a.z-2),this._scene.add(e.distanceHelperXLabel)}if(e.distanceHelperYLabel){e.distanceHelperYLabel.position.set(h.x+3,h.y,h.z-3);const o=document.getElementById(`distance-helper-y-${e.name}`);o.textContent=(t.y*z.default.state.common.unitRatio).toFixed(2)}else{const o=document.createElement("div");o.className="mps-three-label",o.id=`distance-helper-y-${e.name}`,o.textContent=(t.y*z.default.state.common.unitRatio).toFixed(2),o.style=`background-color:transparent;color:${e.distanceHelperColor};font-weight:bold;font-size:20px`,e.distanceHelperYLabel=new E.j(o),e.distanceHelperYLabel.position.set(h.x+3,h.y,h.z-3),this._scene.add(e.distanceHelperYLabel)}if(e.distanceHelperZLabel){e.distanceHelperZLabel.position.set(l.x+3,l.y+2,l.z);const o=document.getElementById(`distance-helper-z-${e.name}`);o.textContent=(t.z*z.default.state.common.unitRatio).toFixed(2)}else{const o=document.createElement("div");o.className="mps-three-label",o.id=`distance-helper-z-${e.name}`,o.textContent=(t.y*z.default.state.common.unitRatio).toFixed(2),o.style=`background-color:transparent;color:${e.distanceHelperColor};font-weight:bold;font-size:20px`,e.distanceHelperZLabel=new E.j(o),e.distanceHelperZLabel.position.set(l.x+3,l.y+2,l.z),this._scene.add(e.distanceHelperZLabel)}this._scene.add(e.distanceHelperXLeft),this._scene.add(e.distanceHelperXRight),this._scene.add(e.distanceHelperYTop),this._scene.add(e.distanceHelperYBottom),this._scene.add(e.distanceHelperZFront),this._scene.add(e.distanceHelperZBack)}else this._disposeDistanceHelperLabel(e)}_disposeDistanceHelperObject(e){e.distanceHelperXLeft&&this._scene.remove(e.distanceHelperXLeft),e.distanceHelperXRight&&this._scene.remove(e.distanceHelperXRight),e.distanceHelperYTop&&this._scene.remove(e.distanceHelperYTop),e.distanceHelperYBottom&&this._scene.remove(e.distanceHelperYBottom),e.distanceHelperZFront&&this._scene.remove(e.distanceHelperZFront),e.distanceHelperZBack&&this._scene.remove(e.distanceHelperZBack)}_disposeDistanceHelperLabel(e){e.distanceHelperXLabel&&(this._scene.remove(e.distanceHelperXLabel),e.distanceHelperXLabel=null),e.distanceHelperYLabel&&(this._scene.remove(e.distanceHelperYLabel),e.distanceHelperYLabel=null),e.distanceHelperZLabel&&(this._scene.remove(e.distanceHelperZLabel),e.distanceHelperZLabel=null)}_createProjectionSize(e,t,o){var i,s,n,r;(null===(i=e.lightBoundC)||void 0===i?void 0:i.geometry)&&(null===(s=e.lightBoundC)||void 0===s||s.geometry.dispose()),(null===(n=e.lightBoundC)||void 0===n?void 0:n.object)&&this._scene.remove(null===(r=e.lightBoundC)||void 0===r?void 0:r.object);const c=z.default.state.projector.selectedProjectors.findIndex((t=>t.uId===e.name))>=0;if(this._isShowDistanceHelper&&c){const i=e.projectionDistance/t.throwRatio,s=i/t.aspectRatio,n=Math.sqrt(Math.pow(i,2)+Math.pow(s,2))*M.OO.inch;e.lightBoundC=this._createRayLine(e.position,o,!0,new d.Ilk(e.distanceHelperColor),!0);const r=e.lightBoundC.object.geometry.points[1];if(e.projectionDistanceLabel){e.projectionDistanceLabel.position.set(r.x,r.y+2,r.z);const t=document.getElementById(`distance-helper-projection-distance-${e.name}`);t.textContent=`${e.projectionDistance.toFixed(2)}`}else{const t=document.createElement("div");t.className="mps-three-label",t.id=`distance-helper-projection-distance-${e.name}`,t.textContent=`${e.projectionDistance.toFixed(2)}`,t.style=`background-color:transparent;color:${e.distanceHelperColor};font-weight:bold;font-size:20px`,e.projectionDistanceLabel=new E.j(t),e.projectionDistanceLabel.position.set(r.x,r.y+2,r.z),this._scene.add(e.projectionDistanceLabel)}if(e.projectionSizeLabel){e.projectionSizeLabel.position.set(r.x,r.y+8,r.z);const t=document.getElementById(`distance-helper-projection-size-${e.name}`);t.textContent=`${n.toFixed(2)}''`}else{const t=document.createElement("div");t.className="mps-three-label",t.id=`distance-helper-projection-size-${e.name}`,t.textContent=`${n.toFixed(2)}''`,t.style=`background-color:transparent;color:${e.distanceHelperColor};font-weight:bold;font-size:20px`,e.projectionSizeLabel=new E.j(t),e.projectionSizeLabel.position.set(r.x,r.y+8,r.z),this._scene.add(e.projectionSizeLabel)}}else this._disposeProjectionSizeLabel(e)}_disposeProjectionSizeLabel(e){e.projectionSizeLabel&&(this._scene.remove(e.projectionSizeLabel),e.projectionSizeLabel=null),e.projectionDistanceLabel&&(this._scene.remove(e.projectionDistanceLabel),e.projectionDistanceLabel=null)}_calcDivideCutPoints(e,t,o,i,s){const n=[],r=30,c=new d.Pa4(1,0,0),a=new d.Pa4(0,1,0),h=new d.Pa4(0,0,1),l=(t[i]-o[i])/r;for(let d=0;d<=r;d++){const o=t.clone();o[i]-=l*d,o.applyAxisAngle(c,s.rotateX/180*Math.PI),o.applyAxisAngle(a,Math.PI+s.rotateY/180*Math.PI),o.applyAxisAngle(h,s.rotateZ/180*Math.PI);const r=this._calcHitPoint(e,o);n.push(r)}return n}_createRayLine(e,t,o,i=5263438,s){const n=this._calcHitPoint(e,t),r=[e,n];s||(s=this._isShowLightBound);const c={geometry:null,object:null};c.geometry=new D.VJ,c.geometry.setPoints(r);const a=new D.r7({color:i,lineWidth:s?.2:0,transparent:!o||s,opacity:s?.2:0});return c.object=new d.Kj0(c.geometry,a),this._scene.add(c.object),c}_createAllBoundLine(){this._projectors.forEach((e=>{this._createBoundLine(e.name)}))}_calcHitPoint(e,t){const o=t.normalize(),i=new d.iMs(e,o),s=[];if(this._isInterfere){const t=this._projectors.find((t=>t.position.x===e.x&&t.position.y===e.y&&t.position.z===e.z));this._projectors.forEach((e=>{e.name!==t.name&&(s.push(e.children[0]),s.push(e.children[1]),s.push(e.children[2]),i.intersectObjects([e.children[0],e.children[1],e.children[2]]).length>0&&(e.isProjectionInterfere=!0))}))}const n=[];this._screens.forEach((e=>{e.screenType!==M.jT.none&&(n.push(e.screenObject.object),e.screenObject.object.children.forEach((e=>{n.push(e)})))}));const r=[this._room.objects.back,this._room.objects.front,this._room.objects.left,this._room.objects.right,this._room.objects.top,this._room.objects.bottom,...n,...s],c=i.intersectObjects(r);return 0===c.length?null:(c[0].point.x-=o.x,c[0].point.y-=o.y,c[0].point.z-=o.z,c[0].point)}_calcHitDistance(e,t){const o=this._calcHitPoint(e,t);return this._currentHitPoint=o,this._currentHitDirection=t,o.distanceTo(e)}_analyzeUndoRedo(e){var t;(null===e||void 0===e?void 0:e.historyIndex)>0?z.default.commit("common/SET_SHOW_UNDO",!0):z.default.commit("common/SET_SHOW_UNDO",!1),(null===e||void 0===e?void 0:e.historyIndex)<(null===e||void 0===e||null===(t=e.historyPoints)||void 0===t?void 0:t.length)-1?z.default.commit("common/SET_SHOW_REDO",!0):z.default.commit("common/SET_SHOW_REDO",!1)}}class k extends ${constructor(e){super(),this._init(e)}_init(e){this._initRenderer(e),this._initScene(),this._initControls(),this._initTransformControl(),this._initTexture().then((()=>{this._initRoom(),this._initScreen()})),this.setTheme()}setScreen(e){this._screens[z.default.state.screen.screenPosition].screenType=e,this._initScreen(this._screens[z.default.state.screen.screenPosition]),this._screens[z.default.state.screen.screenPosition].screenObject.object.updateMatrixWorld(),this._createAllBoundLine()}setScreens(e){e.forEach(((e,t)=>{this._screens[t].screenType=e.screenType,this._screens[t].screenObject.geometry&&this._screens[t].screenObject.geometry.dispose(),this._screens[t].screenObject.object&&this._scene.remove(this._screens[t].screenObject.object),this._screens[t].screenType===M.jT.plane&&this._createPlaneScreen(this._screens[t]),this._screens[t].screenType===M.jT.curved&&this._createCurveScreen(this._screens[t]),this._screens[t].screenType===M.jT.sphere&&this._createSphereScreen(this._screens[t]),this._screens[t].screenType===M.jT.custom&&this._createCustomScreen(this._screens[t]),this._screens[t].screenObject.object&&(this._screens[t].screenObject.object.position.x=e.x*this._roomSize.ratio,this._screens[t].screenObject.object.position.y=e.y*this._roomSize.ratio,this._screens[t].screenObject.object.position.z=e.z*this._roomSize.ratio,this._screens[t].screenObject.object.rotation.x=e.rotateX/180*Math.PI,this._screens[t].screenObject.object.rotation.y=e.rotateY/180*Math.PI,this._screens[t].screenObject.object.rotation.z=e.rotateZ/180*Math.PI)})),this._createAllBoundLine()}setRoomSize(){this._initRoom(),this._initLight()}setScreenPosition(){const e=z.default.state.screen.screens[z.default.state.screen.screenPosition];this._screens[z.default.state.screen.screenPosition].screenObject.object.position.x=e.x*this._roomSize.ratio,this._screens[z.default.state.screen.screenPosition].screenObject.object.position.y=e.y*this._roomSize.ratio,this._screens[z.default.state.screen.screenPosition].screenObject.object.position.z=e.z*this._roomSize.ratio,this._screens[z.default.state.screen.screenPosition].screenObject.object.rotation.x=e.rotateX/180*Math.PI,this._screens[z.default.state.screen.screenPosition].screenObject.object.rotation.y=e.rotateY/180*Math.PI,this._screens[z.default.state.screen.screenPosition].screenObject.object.rotation.z=e.rotateZ/180*Math.PI,this._screens[z.default.state.screen.screenPosition].screenObject.object.updateMatrixWorld(),this._createAllBoundLine()}addProjector(e){z.default.commit("common/SET_IS_LOADING_MODEL",!0),this._addProjector(e).then((e=>{this._projectors.push(e),z.default.commit("projector/SET_SELECTED_PROJECTOR_X",e.position.x/this._roomSize.ratio),z.default.commit("projector/SET_SELECTED_PROJECTOR_Y",e.position.y/this._roomSize.ratio),z.default.commit("projector/SET_SELECTED_PROJECTOR_Z",e.position.z/this._roomSize.ratio),this._createAllBoundLine()})),z.default.commit("common/SET_IS_LOADING_MODEL",!1)}async addProjectorsHistory(e){for(const t of e)await this._addProjector(t.uId).then((e=>{this._projectors.push(e),this.applayProjectorPosition(e,t),this.applayProjectorRotation(e,t)}));z.default.commit("projector/SET_SELECTED_PROJECTOR_UID",e[e.length-1].uId),this._createAllBoundLine()}editProjector(e){const t=this._projectors.find((t=>t.name===e));t&&(document.getElementById(e).textContent=z.default.state.projector.projectors.find((t=>t.uId===e)).customName,this._createAllBoundLine())}setProjector(e){this._setTransformControl(e.uId);const t=this._projectors.find((t=>t.name===e.uId));this.applayProjectorPosition(t,e),this.applayProjectorRotation(t,e),this._isInterfere&&this._analyzeInterfere(),this._createAllBoundLine()}setProjectors(e){e.forEach((e=>{const t=this._projectors.find((t=>t.name===e.uId));this.applayProjectorPosition(t,e),this.applayProjectorRotation(t,e)})),this._createAllBoundLine()}applayProjectorPosition(e,t){e.position.x=t.x*this._roomSize.ratio,e.position.y=t.y*this._roomSize.ratio,e.position.z=t.z*this._roomSize.ratio}applayProjectorRotation(e,t){if(e.rotation.x=0,e.rotation.y=0,e.rotation.z=0,e.directionCenter&&0!==t.rotateZ){const t=new d._fP;t.setFromUnitVectors(new d.Pa4(0,0,1),e.directionCenter.normalize()),e.setRotationFromQuaternion(t)}else{const o=new d.Pa4(1,0,0),i=new d.Pa4(0,1,0),s=new d.Pa4(0,0,1);o.applyAxisAngle(i,Math.PI+t.rotateY/180*Math.PI),s.applyAxisAngle(i,Math.PI+t.rotateY/180*Math.PI),e.rotateOnAxis(o,t.rotateX/180*Math.PI),e.rotateOnAxis(i,Math.PI+t.rotateY/180*Math.PI),e.rotateOnAxis(s,t.rotateZ/180*Math.PI)}}deleteProjector(e){const t=this._projectors.findIndex((t=>t.name===e)),o=this._projectors[t];this._transformControl.object===o&&this._transformControl.detach(),this._disposeBoundLine(e),this._disposeDistanceHelperObject(o),this._disposeDistanceHelperLabel(o),this._disposeProjectionSizeLabel(o),document.getElementById(e).remove(),this._projectors.splice(t,1),this._scene.remove(o)}setProjectorTexture({patternSrc:e,isVideo:t}){z.default.commit("projector/SET_SELECTED_PROJECTOR_TEXTURE",e),!this._textures[e]&&e?this._loadTexture(e,t).then((t=>{this._textures[e]=t,this._createAllBoundLine()})):this._createAllBoundLine()}setScreenTexture({patternSrc:e,isVideo:t}){!this._textures[e]&&e?this._loadTexture(e,t).then((t=>{this._textures[e]=t,this._screens[z.default.state.screen.screenPosition].screenObject.material=new d.vBJ({map:t,side:d.ehD,transparent:!0,opacity:.8}),this._initScreen(this._screens[z.default.state.screen.screenPosition])})):(this._screens[z.default.state.screen.screenPosition].screenObject.material=new d.vBJ({map:this._textures[e],side:d.ehD,transparent:!0,opacity:.8}),this._initScreen(this._screens[z.default.state.screen.screenPosition]))}getDataUrl(){this._renderer.preserveDrawingBuffer=!0,this._render();const e=this._renderer.domElement.toDataURL("image/jpeg");return this._renderer.preserveDrawingBuffer=!1,e}frontCamera(){this._camera.position.set(this._roomSize.widthDraw/2,this._roomSize.heightDraw/2,1.6*this._roomSize.depthDraw),this._camera.lookAt(this._roomSize.widthDraw/2,this._roomSize.heightDraw/2,0),this._controls.target.copy(new d.Pa4(this._roomSize.widthDraw/2,this._roomSize.heightDraw/2,0))}sideCamera(){this._camera.position.set(2.5*this._roomSize.widthDraw,this._roomSize.heightDraw/2,this._roomSize.depthDraw/2),this._camera.lookAt(0,this._roomSize.heightDraw/2,this._roomSize.depthDraw/2),this._controls.target.copy(new d.Pa4(0,this._roomSize.heightDraw/2,this._roomSize.depthDraw/2))}topCamera(){this._camera.position.set(this._roomSize.widthDraw/2,4*this._roomSize.heightDraw,this._roomSize.depthDraw/2),this._camera.lookAt(this._roomSize.widthDraw/2,0,this._roomSize.depthDraw/2),this._controls.target.copy(new d.Pa4(this._roomSize.widthDraw/2,0,this._roomSize.depthDraw/2))}undo(){const e=this._transformControl.object;if(e.historyIndex>0){const t=e.historyPoints[e.historyIndex-1];z.default.commit("projector/SET_SELECTED_PROJECTOR_X",t.x/this._roomSize.ratio),z.default.commit("projector/SET_SELECTED_PROJECTOR_Y",t.y/this._roomSize.ratio),z.default.commit("projector/SET_SELECTED_PROJECTOR_Z",t.z/this._roomSize.ratio),e.position.x=t.x,e.position.y=t.y,e.position.z=t.z,this._isInterfere&&this._analyzeInterfere(),this._createBoundLine(this._transformControl.object.name),e.historyIndex--,e&&this._analyzeUndoRedo(e)}}redo(){var e;const t=this._transformControl.object;if((null===(e=t.historyPoints)||void 0===e?void 0:e.length)-1>t.historyIndex){const e=t.historyPoints[t.historyIndex+1];z.default.commit("projector/SET_SELECTED_PROJECTOR_X",e.x/this._roomSize.ratio),z.default.commit("projector/SET_SELECTED_PROJECTOR_Y",e.y/this._roomSize.ratio),z.default.commit("projector/SET_SELECTED_PROJECTOR_Z",e.z/this._roomSize.ratio),t.position.x=e.x,t.position.y=e.y,t.position.z=e.z,this._isInterfere&&this._analyzeInterfere(),this._createBoundLine(this._transformControl.object.name),t.historyIndex++,this._analyzeUndoRedo(t)}}changeSelectedProjector(e){const t=this._projectors.find((t=>t.name===e));t?this._analyzeUndoRedo(t):this._analyzeUndoRedo({})}updateShowRefrence(e){if(e){this._scene.add(this._axesX),this._scene.add(this._axesY),this._scene.add(this._axesZ);const e=document.getElementsByClassName("axex-refer");for(let t=0;t<e.length;++t)e[t].style.visibility=""}else{this._scene.remove(this._axesX),this._scene.remove(this._axesY),this._scene.remove(this._axesZ);const e=document.getElementsByClassName("axex-refer");for(let t=0;t<e.length;++t)e[t].style.visibility="hidden"}}updateShowProjectorInterfere(e){this._isInterfere=e,this._createAllBoundLine(),this._analyzeInterfere()}updateShowProjectionDistanceRefrence(e){this._isShowDistanceRefrence=e,this._createAllBoundLine()}updateShowLightBound(e){this._isShowLightBound=e,this._createAllBoundLine()}updateShowDistanceHelper(e){void 0!==e&&(this._isShowDistanceHelper=e),this._createAllBoundLine()}updateShowGrid(e){e?this._scene.add(this._gridHelper):this._scene.remove(this._gridHelper)}updateRoomBrightness(e){this._light.power=4*Math.PI*e/250,this._createAllBoundLine()}setLight(e){const{x:t,y:o,z:i}=e;this._light.position.set(t*this._roomSize.ratio,o*this._roomSize.ratio,i*this._roomSize.ratio)}}let A=null;const Z={name:"PageIndex",components:{ProjectorDetail:x},created(){this.$bus.on("setScreen",this.setScreen),this.$bus.on("setScreens",this.setScreens),this.$bus.on("setScreenPosition",this.setScreenPosition),this.$bus.on("autoAdjustScreenPosition",this.autoAdjustScreenPosition),this.$bus.on("setRoomSize",this.setRoomSize),this.$bus.on("addProjector",this.addProjector),this.$bus.on("addProjectorsHistory",this.addProjectorsHistory),this.$bus.on("editProjector",this.editProjector),this.$bus.on("setProjector",this.setProjector),this.$bus.on("setProjectors",this.setProjectors),this.$bus.on("deleteProjector",this.deleteProjector),this.$bus.on("setProjectorTexture",this.setProjectorTexture),this.$bus.on("setScreenTexture",this.setScreenTexture),this.$bus.on("initThreeViewImage",this.initThreeViewImage),this.$bus.on("setTheme",this.setTheme),this.$bus.on("updateShowRefrence",this.updateShowRefrence),this.$bus.on("updateShowProjectorInterfere",this.updateShowProjectorInterfere),this.$bus.on("updateShowProjectionDistanceRefrence",this.updateShowProjectionDistanceRefrence),this.$bus.on("updateShowLightBound",this.updateShowLightBound),this.$bus.on("updateShowDistanceHelper",this.updateShowDistanceHelper),this.$bus.on("updateShowGrid",this.updateShowGrid),this.$bus.on("updateRoomBrightness",this.updateRoomBrightness),this.$bus.on("setLight",this.setLight),this.$bus.on("changeSelectedProjector",this.changeSelectedProjector)},beforeUnmount(){this.$bus.off("setScreen",this.setScreen),this.$bus.off("setScreens",this.setScreens),this.$bus.off("setScreenPosition",this.setScreenPosition),this.$bus.off("autoAdjustScreenPosition",this.autoAdjustScreenPosition),this.$bus.off("setRoomSize",this.setRoomSize),this.$bus.off("addProjector",this.addProjector),this.$bus.off("addProjectorsHistory",this.addProjectorsHistory),this.$bus.off("editProjector",this.editProjector),this.$bus.off("setProjector",this.setProjector),this.$bus.off("setProjectors",this.setProjectors),this.$bus.off("deleteProjector",this.deleteProjector),this.$bus.off("setProjectorTexture",this.setProjectorTexture),this.$bus.off("setScreenTexture",this.setScreenTexture),this.$bus.off("initThreeViewImage",this.initThreeViewImage),this.$bus.off("setTheme",this.setTheme),this.$bus.off("updateShowRefrence",this.updateShowRefrence),this.$bus.off("updateShowProjectorInterfere",this.updateShowProjectorInterfere),this.$bus.off("updateShowProjectionDistanceRefrence",this.updateShowProjectionDistanceRefrence),this.$bus.off("updateShowLightBound",this.updateShowLightBound),this.$bus.off("updateShowDistanceHelper",this.updateShowDistanceHelper),this.$bus.off("updateShowGrid",this.updateShowGrid),this.$bus.off("updateRoomBrightness",this.updateRoomBrightness),this.$bus.off("setLight",this.setLight),this.$bus.off("changeSelectedProjector",this.changeSelectedProjector)},mounted(){A=new k("#threeView"),A.animate(),document.getElementById("threeView").addEventListener("mousedown",(e=>{e.button===d.RsA.RIGHT&&this.$store.state.common.isToShowContextmenu&&(this.contextmenuLeft=`${e.offsetX}px`,this.contextmenuTop=`${e.offsetY}px`,this.isShowContextmenu=!0),e.button===d.RsA.LEFT&&this.isShowContextmenu&&(this.isShowContextmenu=!1)}))},data(){return{view:null,isShowContextmenu:!1,contextmenuLeft:"0px",contextmenuTop:"0px",slide:1}},computed:{showUndo(){return this.$store.state.common.showUndo},showRedo(){return this.$store.state.common.showRedo}},methods:l()(l()({},(0,m.OI)("common",["SET_THREE_VIEW_IMAGE"])),{},{stylePage(e,t){return{height:t-e+"px"}},resizeCanvas(){A.onWindowResize()},setRoomSize(){A.setRoomSize()},setScreen(e){A.setScreen(e)},setScreens(e){A.setScreens(e)},setScreenPosition(){A.setScreenPosition()},autoAdjustScreenPosition(){A.adjustScreenPosition()},addProjector(e){A.addProjector(e)},addProjectorsHistory(e){A.addProjectorsHistory(e)},editProjector(e){A.editProjector(e)},setProjector(e){A.setProjector(e)},setProjectors(e){A.setProjectors(e)},deleteProjector(e){A.deleteProjector(e)},setProjectorTexture(e){A.setProjectorTexture(e)},setScreenTexture(e){A.setScreenTexture(e)},initThreeViewImage(){const e=A.getDataUrl();this.SET_THREE_VIEW_IMAGE(e)},frontCamera(){A.frontCamera()},sideCamera(){A.sideCamera()},topCamera(){A.topCamera()},undo(){A.undo()},redo(){A.redo()},setTheme(){A.setTheme()},updateShowRefrence(e){A.updateShowRefrence(e)},updateShowProjectorInterfere(e){A.updateShowProjectorInterfere(e)},updateShowProjectionDistanceRefrence(e){A.updateShowProjectionDistanceRefrence(e)},updateShowLightBound(e){A.updateShowLightBound(e)},updateShowGrid(e){A.updateShowGrid(e)},updateShowDistanceHelper(e){A.updateShowDistanceHelper(e)},setLight(e){A.setLight(e)},updateRoomBrightness(e){A.updateRoomBrightness(e)},changeSelectedProjector(e){A.changeSelectedProjector(e)},clickDeleteProjector(){this.$bus.emit("clickDeleteProjector"),this.isShowContextmenu=!1},clickCopyProjector(){this.$bus.emit("clickCopyProjector"),this.isShowContextmenu=!1},clickEditProjector(){this.$bus.emit("clickEditProjector"),this.isShowContextmenu=!1}})};var G=o(24379),N=o(48240),W=o(5363),X=o(83944),Y=o(31277),q=o(34593),U=o(27011),F=o(83414),J=o(52035),V=o(24554),Q=o(15151),K=o(46489);Z.render=a,Z.__scopeId="data-v-1c1f23ee";const ee=Z;R()(Z,"components",{QPage:G.Z,QBtn:N.Z,QTooltip:W.Z,QPopupProxy:X.Z,QCarousel:Y.Z,QCarouselSlide:q.Z,QList:U.Z,QItem:F.Z,QItemSection:J.Z,QIcon:V.Z,QResizeObserver:Q.Z}),R()(Z,"directives",{Ripple:K.Z})}}]);