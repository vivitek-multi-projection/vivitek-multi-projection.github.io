"use strict";(self["webpackChunkmps"]=self["webpackChunkmps"]||[]).push([[938],{2934:(e,t,o)=>{o.d(t,{OO:()=>i,jT:()=>s});const i={m:1,cm:100,mm:1e3,inch:39.3700787,feet:3.2808399},s={plane:0,curved:1,sphere:2,halfSphere:3,partialSphere:4}},8938:(e,t,o)=>{o.r(t),o.d(t,{default:()=>G});var i=o(3673);const s=(0,i.HX)("data-v-6496bb0b");(0,i.dD)("data-v-6496bb0b");const r={class:"fit",id:"threeView"};(0,i.Cn)();const n=s(((e,t,o,n,a,h)=>{const c=(0,i.up)("ProjectorDetail"),l=(0,i.up)("q-resize-observer"),d=(0,i.up)("q-page");return(0,i.wg)(),(0,i.j4)(d,{class:"flex flex-center","style-fn":h.stylePage},{default:s((()=>[(0,i.Wm)("div",r,[(0,i.Wm)(c),(0,i.Wm)(l,{onResize:h.resizeCanvas,debounce:"100"},null,8,["onResize"])])])),_:1},8,["style-fn"])}));var a=o(2323),h=o(8880);const c=(0,i.HX)("data-v-1fe1779a");(0,i.dD)("data-v-1fe1779a");const l={class:"absolute absolute-bottom-left detail-wrapper"},d={class:"row items-center no-wrap"},_={class:"col"},m={class:"text-h6"},u={key:0},p={class:"col-auto"},S={class:"q-gutter-sm row"},j=(0,i.Wm)("div",{class:"text-subtitle2"}," X: ",-1),f=(0,i.Wm)("div",{class:"text-subtitle2"}," Y: ",-1),b=(0,i.Wm)("div",{class:"text-subtitle2"}," Z: ",-1),v={class:"text-subtitle2"},P={class:"text-subtitle2"},g={class:"text-subtitle2"},w={class:"text-subtitle2"},E={class:"text-subtitle2"},T={class:"text-subtitle2"};(0,i.Cn)();const R=c(((e,t,o,s,r,n)=>{const R=(0,i.up)("q-btn"),y=(0,i.up)("q-card-section"),z=(0,i.up)("q-input"),L=(0,i.up)("q-card");return(0,i.wy)(((0,i.wg)(),(0,i.j4)("div",l,[n.selectedProjector?((0,i.wg)(),(0,i.j4)(L,{key:0,class:"fit bg-light-green-1"},{default:c((()=>[(0,i.Wm)(y,{class:"q-pa-none q-pl-md q-pr-xs"},{default:c((()=>[(0,i.Wm)("div",d,[(0,i.Wm)("div",_,[(0,i.Wm)("div",m,[(0,i.Wm)("span",null,(0,a.zw)(`${n.selectedProjector.customName}(${n.selectedProjector.modelName})`),1),n.selectedProjector.lensName?((0,i.wg)(),(0,i.j4)("span",u,(0,a.zw)(`  &&  ${n.selectedProjector.lensName}`),1)):(0,i.kq)("",!0)])]),(0,i.Wm)("div",p,[(0,i.Wm)(R,{color:"grey-7",round:"",flat:"",icon:"arrow_drop_down",onClick:t[1]||(t[1]=e=>n.showProjectorDetail=!1)})])])])),_:1}),(0,i.Wm)(y,null,{default:c((()=>[(0,i.Wm)("div",S,[(0,i.Wm)(z,{"model-value":n.selectedProjector.x,"onUpdate:modelValue":n.setX,suffix:n.unitLabel,title:`${n.selectedProjector.x}${n.unitLabel}`,dense:"",color:e.$q.dark.isActive?"primary":"positive",type:"number",step:"0.1",style:{width:"185px"}},{prepend:c((()=>[j])),_:1},8,["model-value","onUpdate:modelValue","suffix","title","color"]),(0,i.Wm)(z,{"model-value":n.selectedProjector.y,"onUpdate:modelValue":n.setY,suffix:n.unitLabel,title:`${n.selectedProjector.y}${n.unitLabel}`,dense:"",color:e.$q.dark.isActive?"primary":"positive",type:"number",step:"0.1",style:{width:"185px"}},{prepend:c((()=>[f])),_:1},8,["model-value","onUpdate:modelValue","suffix","title","color"]),(0,i.Wm)(z,{"model-value":n.selectedProjector.z,"onUpdate:modelValue":n.setZ,title:`${n.selectedProjector.z}${n.unitLabel}`,dense:"",color:e.$q.dark.isActive?"primary":"positive",type:"number",step:"0.1",suffix:n.unitLabel,style:{width:"185px"}},{prepend:c((()=>[b])),_:1},8,["model-value","onUpdate:modelValue","title","color","suffix"]),(0,i.Wm)(z,{"model-value":n.selectedProjector.rotateX,"onUpdate:modelValue":n.setRotateX,title:`${n.selectedProjector.rotateX}°`,dense:"",color:e.$q.dark.isActive?"primary":"positive",type:"number",step:"2",min:"-180",max:"180",suffix:"°",style:{width:"185px"}},{prepend:c((()=>[(0,i.Wm)("div",v,(0,a.zw)(e.$t("rotateX"))+": ",1)])),_:1},8,["model-value","onUpdate:modelValue","title","color"]),(0,i.Wm)(z,{"model-value":n.selectedProjector.rotateY,"onUpdate:modelValue":n.setRotateY,title:`${n.selectedProjector.rotateY}°`,dense:"",color:e.$q.dark.isActive?"primary":"positive",type:"number",step:"2",min:"-180",max:"180",suffix:"°",style:{width:"185px"}},{prepend:c((()=>[(0,i.Wm)("div",P,(0,a.zw)(e.$t("rotateY"))+": ",1)])),_:1},8,["model-value","onUpdate:modelValue","title","color"]),(0,i.Wm)(z,{"model-value":n.selectedProjector.rotateZ,"onUpdate:modelValue":n.setRotateZ,title:`${n.selectedProjector.rotateZ}°`,dense:"",color:e.$q.dark.isActive?"primary":"positive",type:"number",step:"2",min:"-180",max:"180",suffix:"°",style:{width:"185px"}},{prepend:c((()=>[(0,i.Wm)("div",g,(0,a.zw)(e.$t("rotateZ"))+": ",1)])),_:1},8,["model-value","onUpdate:modelValue","title","color"]),(0,i.Wm)(z,{"model-value":n.selectedProjector.lensShiftH,"onUpdate:modelValue":n.setLensShiftH,title:`${n.selectedProjector.lensShiftH}%`,dense:"",color:e.$q.dark.isActive?"primary":"positive",type:"number",min:n.selectedProjector.lensShiftHMin,max:n.selectedProjector.lensShiftHMax,step:"1",suffix:"%",style:{width:"185px"}},{prepend:c((()=>[(0,i.Wm)("div",w,(0,a.zw)(e.$t("lensShiftH"))+": ",1)])),_:1},8,["model-value","onUpdate:modelValue","title","color","min","max"]),(0,i.Wm)(z,{"model-value":n.selectedProjector.lensShiftV,"onUpdate:modelValue":n.setLensShiftV,title:`${n.selectedProjector.lensShiftV}%`,dense:"",color:e.$q.dark.isActive?"primary":"positive",type:"number",min:n.selectedProjector.lensShiftVMin,max:n.selectedProjector.lensShiftVMax,step:"1",suffix:"%",style:{width:"185px"}},{prepend:c((()=>[(0,i.Wm)("div",E,(0,a.zw)(e.$t("lensShiftV"))+": ",1)])),_:1},8,["model-value","onUpdate:modelValue","title","color","min","max"]),(0,i.Wm)(z,{"model-value":n.selectedProjector.throwRatio,"onUpdate:modelValue":n.setThrowRatio,title:`${n.selectedProjector.throwRatio}`,dense:"",color:e.$q.dark.isActive?"primary":"positive",type:"number",min:n.selectedProjector.throwRatioMin,max:n.selectedProjector.throwRatioMax,step:"0.1",style:{width:"185px"}},{prepend:c((()=>[(0,i.Wm)("div",T,(0,a.zw)(e.$t("throwRatio"))+": ",1)])),_:1},8,["model-value","onUpdate:modelValue","title","color","min","max"])])])),_:1})])),_:1})):(0,i.kq)("",!0)],512)),[[h.F8,n.showProjectorDetail]])}));var y=o(515),z=o.n(y),L=o(7874);const C={name:"Projector-Detail",data(){return{}},computed:{unitLabel(){return this.$store.state.common.unitLabel},showProjectorDetail:{get(){return this.$store.state.common.showProjectorDetail},set(e){this.SET_SHOW_PROJECTOR_DETAIL(e)}},selectedProjector(){return this.$store.getters["projector/selectedProjector"]}},methods:z()(z()(z()({},(0,L.OI)("common",["SET_SHOW_PROJECTOR_DETAIL"])),(0,L.OI)("projector",["SET_SELECTED_PROJECTOR_X","SET_SELECTED_PROJECTOR_Y","SET_SELECTED_PROJECTOR_Z","SET_SELECTED_PROJECTOR_ROTATE_X","SET_SELECTED_PROJECTOR_ROTATE_Y","SET_SELECTED_PROJECTOR_ROTATE_Z","SET_SELECTED_PROJECTOR_LENS_SHIFT_H","SET_SELECTED_PROJECTOR_LENS_SHIFT_V","SET_SELECTED_PROJECTOR_THROW_RATIO"])),{},{setX(e){this.SET_SELECTED_PROJECTOR_X(e),this.setProjector()},setY(e){this.SET_SELECTED_PROJECTOR_Y(e),this.setProjector()},setZ(e){this.SET_SELECTED_PROJECTOR_Z(e),this.setProjector()},setRotateX(e){this.SET_SELECTED_PROJECTOR_ROTATE_X(e),this.setProjector()},setRotateY(e){this.SET_SELECTED_PROJECTOR_ROTATE_Y(e),this.setProjector()},setRotateZ(e){this.SET_SELECTED_PROJECTOR_ROTATE_Z(e),this.setProjector()},setLensShiftH(e){this.SET_SELECTED_PROJECTOR_LENS_SHIFT_H(e),this.setProjector()},setLensShiftV(e){this.SET_SELECTED_PROJECTOR_LENS_SHIFT_V(e),this.setProjector()},setThrowRatio(e){this.SET_SELECTED_PROJECTOR_THROW_RATIO(e),this.setProjector()},setProjector(){this.$bus.emit("setProjector",this.selectedProjector)}})};var x=o(151),D=o(5589),O=o(8240),B=o(4842),M=o(7518),I=o.n(M);C.render=R,C.__scopeId="data-v-1fe1779a";const A=C;I()(C,"components",{QCard:x.Z,QCardSection:D.Z,QBtn:O.Z,QInput:B.Z});var $=o(4241),W=(o(71),o(5691)),k=o(2483),V=o(7742),J=o(5810),H=o(3991),U=o(5389),Y=o(9058),Z=o(2934);class q{constructor(){this._renderer=null,this._dom=null,this._camera=null,this._scene=null,this._light=null,this._raycaster=new H.iMs,this._mouse=new H.FM8,this._hotProjectorUid="",this._projectors=[],this._texture={wall:null,floor:null},this._room={material:{front:null,back:null,left:null,right:null,top:null,bottom:null},geometrys:{front:null,back:null,left:null,right:null,top:null,bottom:null},objects:{front:null,back:null,left:null,right:null,top:null,bottom:null}},this._roomSize={width:0,height:0,depth:0,widthDraw:0,heightDraw:0,depthDraw:0,ratio:10},this._screenType=Z.jT.plane,this._screen={material:null,geometry:null,object:null},this._planeScreen={diagonal:0,aspectRatio:0},this._curvedScreen={diagonal:0,aspectRatio:0,radius:0,radialSegments:3,isSmooth:!0},this._sphereScreen={radius:0,phiStart:0,phiLength:100},this._halfSphereScreen={radius:0},this._partialSphereScreen={radius:0,startAngle:0,endAngle:0},this._controls=null}_initRenderer(e){this._renderer=new H.CP7,this._dom=document.querySelector(e),this._dom.appendChild(this._renderer.domElement);const t=this._dom.getBoundingClientRect();this._renderer.setSize(t.width,t.height+20),this._initCamera(t),this._dom.addEventListener("mousemove",(e=>{this._onMouseMove(e)}),!1),this._dom.addEventListener("mousedown",(()=>{this._onMouseDown()}),!1)}onWindowResize(){const e=this._dom.getBoundingClientRect();this._camera.aspect=e.width/e.height,this._camera.updateProjectionMatrix(),this._renderer.setSize(e.width,e.height)}_onMouseMove(e){const t=this._dom.getBoundingClientRect();this._mouse.x=e.offsetX/t.width*2-1,this._mouse.y=-e.offsetY/t.height*2+1}_onMouseDown(){this._hotProjectorUid&&($.default.commit("projector/SET_SELECTED_PROJECTOR_UID",this._hotProjectorUid),this._setTransformControl(this._hotProjectorUid),this._createAllBoundLine())}_setTransformControl(e){const t=this._projectors.find((t=>t.name===e));this._transformControl.object!==t&&this._transformControl.attach(t)}_initCamera(e){this._camera=new H.cPb(40,e.width/e.height,.1,1e3),this._camera.position.set(24,50,-200),this._camera.lookAt(0,0,0)}_initScene(){this._scene=new H.xsS,this._initLight(),this.setTheme()}_initLight(){this._roomSize.depth=$.default.state.room.depth,this._roomSize.depthDraw=this._roomSize.depth*this._roomSize.ratio,this._light?this._light.position.set(0,0,this._roomSize.depthDraw/2):(this._light=new H.cek(16777215,1.2,0,2),this._light.position.set(0,0,this._roomSize.depthDraw/2),this._scene.add(this._light))}_initControls(){this._controls=new W.z(this._camera,this._renderer.domElement),this._controls.addEventListener("change",(()=>{}))}_initTransformControl(){this._transformControl=new k.Ys(this._camera,this._renderer.domElement),this._transformControl.addEventListener("dragging-changed",(e=>{this._controls.enabled=!e.value}));let e=0;this._transformControl.addEventListener("change",(t=>{e++,e%2===0&&this._transformControl.object&&($.default.commit("projector/SET_SELECTED_PROJECTOR_X",this._transformControl.object.position.x/this._roomSize.ratio),$.default.commit("projector/SET_SELECTED_PROJECTOR_Y",this._transformControl.object.position.y/this._roomSize.ratio),$.default.commit("projector/SET_SELECTED_PROJECTOR_Z",this._transformControl.object.position.z/this._roomSize.ratio),this._createBoundLine(this._transformControl.object.name))})),this._scene.add(this._transformControl)}_render(){this._raycaster.setFromCamera(this._mouse,this._camera),this._hotProjectorUid=null,this._projectors.forEach((e=>{const t=this._raycaster.intersectObjects(e.children);t.length>0?e.children.forEach((t=>{t.material.emissive.setHex(255),this._hotProjectorUid=e.name})):e.children.forEach((e=>{e.material.emissive.setHex(0)}))})),this._renderer.render(this._scene,this._camera)}setTheme(){this._scene.background=Y.Z.isActive?new H.Ilk(1250327):new H.Ilk(16776427)}animate(){requestAnimationFrame((()=>{this.animate()})),this._render()}_initTexture(){const e=new H.dpR,t=new Promise(((t,o)=>{e.load("texture/wall.jfif",(e=>{const o=new H.YBo({map:e,side:H.Wl3,emissive:16711422,emissiveIntensity:.2});this._room.material.front=o,this._room.material.back=o,this._room.material.left=o,this._room.material.right=o,this._room.material.top=o,t(e)}),null,(e=>{o(e)}))})),o=new Promise(((t,o)=>{e.load("texture/floor.jfif",(e=>{const o=new H.YBo({map:e,side:H.Wl3,emissive:16711422,emissiveIntensity:.2});this._room.material.bottom=o,t(e)}),null,(e=>{o(e)}))})),i=new Promise(((t,o)=>{e.load("texture/screen2.jpg",(e=>{const o=new H.vBJ({map:e,side:H.ehD,transparent:!0,opacity:.8});this._screen.material=o,t(e)}),null,(e=>{o(e)}))}));return Promise.all([t,o,i])}_initRoom(){this._roomSize.width=$.default.state.room.width,this._roomSize.height=$.default.state.room.height,this._roomSize.depth=$.default.state.room.depth,this._roomSize.widthDraw=this._roomSize.width*this._roomSize.ratio,this._roomSize.heightDraw=this._roomSize.height*this._roomSize.ratio,this._roomSize.depthDraw=this._roomSize.depth*this._roomSize.ratio,this._room&&(Object.values(this._room.geometrys).forEach((e=>{e&&e.dispose()})),Object.values(this._room.objects).forEach((e=>{e&&this._scene.remove(e)}))),this._room.geometrys.front=new H._12(this._roomSize.widthDraw,this._roomSize.heightDraw),this._room.objects.front=new H.Kj0(this._room.geometrys.front,this._room.material.front),this._room.objects.front.position.z=this._roomSize.depthDraw,this._room.objects.front.rotateY(1*Math.PI),this._scene.add(this._room.objects.front),this._room.geometrys.back=new H._12(this._roomSize.widthDraw,this._roomSize.heightDraw),this._room.objects.back=new H.Kj0(this._room.geometrys.back,this._room.material.back),this._scene.add(this._room.objects.back),this._room.geometrys.top=new H._12(this._roomSize.widthDraw,this._roomSize.depthDraw),this._room.objects.top=new H.Kj0(this._room.geometrys.top,this._room.material.top),this._room.objects.top.position.z=this._roomSize.depthDraw/2,this._room.objects.top.position.y=this._roomSize.heightDraw/2,this._room.objects.top.rotateX(.5*Math.PI),this._scene.add(this._room.objects.top),this._room.geometrys.bottom=new H._12(this._roomSize.widthDraw,this._roomSize.depthDraw),this._room.objects.bottom=new H.Kj0(this._room.geometrys.bottom,this._room.material.bottom),this._room.objects.bottom.position.z=this._roomSize.depthDraw/2,this._room.objects.bottom.position.y=-this._roomSize.heightDraw/2,this._room.objects.bottom.rotateX(-.5*Math.PI),this._scene.add(this._room.objects.bottom),this._room.geometrys.left=new H._12(this._roomSize.depthDraw,this._roomSize.heightDraw),this._room.objects.left=new H.Kj0(this._room.geometrys.left,this._room.material.left),this._room.objects.left.position.z=this._roomSize.depthDraw/2,this._room.objects.left.position.x=this._roomSize.widthDraw/2,this._room.objects.left.rotateY(-.5*Math.PI),this._scene.add(this._room.objects.left),this._room.geometrys.right=new H._12(this._roomSize.depthDraw,this._roomSize.heightDraw),this._room.objects.right=new H.Kj0(this._room.geometrys.right,this._room.material.right),this._room.objects.right.position.z=this._roomSize.depthDraw/2,this._room.objects.right.position.x=-this._roomSize.widthDraw/2,this._room.objects.right.rotateY(.5*Math.PI),this._scene.add(this._room.objects.right)}_initScreen(){this._screen.geometry&&this._screen.geometry.dispose(),this._screen.object&&this._scene.remove(this._screen.object),this._screenType===Z.jT.plane&&this._createPlaneScreen(),this._screenType===Z.jT.curved&&this._createCurveScreen(),this._screenType===Z.jT.sphere&&this._createSphereScreen(),this.adjustScreenPosition()}adjustScreenPosition(){const e=this._screen.geometry.attributes.position.array,t=this._screen.geometry.attributes.position.count;let o=0,i=0,s=0,r=0,n=0;for(let a=0;a<t;a++){const[t,h,c]=[e[3*a],e[3*a+1],e[3*a+2]];t<o&&(o=t),t>i&&(i=t),h<s&&(s=h),h>r&&(r=h),c>n&&(n=c)}this._screen.object.position.x=this._roomSize.widthDraw/2-i-(o- -this._roomSize.widthDraw/2),this._screen.object.position.y=this._roomSize.heightDraw/2-r-(s- -this._roomSize.heightDraw/2),this._screen.object.position.z=this._roomSize.depthDraw-n-.5*this._roomSize.ratio,this._screen.object.position.x=0,this._screen.object.position.y=0,this._screen.object.position.z=this._roomSize.depthDraw-n-1*this._roomSize.ratio,$.default.commit("screen/SET_X",this._screen.object.position.x/this._roomSize.ratio),$.default.commit("screen/SET_Y",this._screen.object.position.y/this._roomSize.ratio),$.default.commit("screen/SET_Z",this._screen.object.position.z/this._roomSize.ratio),$.default.commit("screen/SET_ROTATE_X",this._screen.object.rotation.x/Math.PI*180),$.default.commit("screen/SET_ROTATE_Y",this._screen.object.rotation.y/Math.PI*180),$.default.commit("screen/SET_ROTATE_Z",this._screen.object.rotation.z/Math.PI*180)}_createPlaneScreen(){this._planeScreen.diagonal=$.default.state.screen.plane.diagonal,this._planeScreen.aspectRatio=$.default.state.screen.plane.aspectRatio,0===this._planeScreen.aspectRatio&&(this._planeScreen.aspectRatio=$.default.state.screen.plane.width/$.default.state.screen.plane.height);const e=this._planeScreen.diagonal/Z.OO.inch,t=Math.atan(this._planeScreen.aspectRatio),o=e*Math.sin(t),i=o/this._planeScreen.aspectRatio;this._screen.geometry=new H._12(o*this._roomSize.ratio,i*this._roomSize.ratio),this._screen.object=new H.Kj0(this._screen.geometry,this._screen.material),this._scene.add(this._screen.object)}_createCurveScreen(){this._curvedScreen.diagonal=$.default.state.screen.curved.diagonal,this._curvedScreen.aspectRatio=$.default.state.screen.curved.aspectRatio,this._curvedScreen.radius=$.default.state.screen.curved.radius*this._roomSize.ratio,this._curvedScreen.radialSegments=$.default.state.screen.curved.radialSegments,this._curvedScreen.isSmooth=$.default.state.screen.curved.isSmooth,0===this._curvedScreen.aspectRatio&&(this._curvedScreen.aspectRatio=$.default.state.screen.curved.width/$.default.state.screen.curved.height);const e=this._curvedScreen.diagonal/Z.OO.inch,t=Math.atan(this._curvedScreen.aspectRatio),o=e*Math.sin(t),i=o/this._curvedScreen.aspectRatio,s=o*this._roomSize.ratio/this._curvedScreen.radius;this._screen.geometry=new H.fHI(this._curvedScreen.radius,this._curvedScreen.radius,i*this._roomSize.ratio,this._curvedScreen.isSmooth?128:this._curvedScreen.radialSegments,1,!0,-s/2,s),this._screen.object=new H.Kj0(this._screen.geometry,this._screen.material),this._scene.add(this._screen.object)}_createSphereScreen(){this._sphereScreen.radius=$.default.state.screen.sphere.radius*this._roomSize.ratio,this._sphereScreen.phiStart=$.default.state.screen.sphere.phiStart/180*Math.PI,this._sphereScreen.phiLength=$.default.state.screen.sphere.phiLength/180*Math.PI,this._sphereScreen.thetaStart=$.default.state.screen.sphere.thetaStart/180*Math.PI,this._sphereScreen.thetaLength=(1-$.default.state.screen.sphere.thetaEnd/180-$.default.state.screen.sphere.thetaStart/180)*Math.PI,this._screen.geometry=new H.xo$(this._sphereScreen.radius,16,16,this._sphereScreen.phiStart,this._sphereScreen.phiLength,this._sphereScreen.thetaStart,this._sphereScreen.thetaLength),this._screen.object=new H.Kj0(this._screen.geometry,this._screen.material),this._scene.add(this._screen.object)}_addProjecotr(e){const t=new J.v,o=new V.L,i=new Promise(((i,s)=>{t.load("models/H7T_Laset7.mtl",(t=>{o.setMaterials(t),o.load("models/H7T_Laset7.obj",(t=>{t.children.forEach((e=>{e.geometry.computeBoundingBox(),e.geometry.center()})),t.name=e,t.position.z=this._roomSize.depthDraw/2,this._scene.add(t),this._transformControl.attach(t),i(t)}),void 0,(e=>{s(e)}))}),void 0,(e=>{s(e)}))}));return i}_disposeBoundLine(e){var t,o,i,s,r,n,a,h,c,l,d,_,m,u,p,S,j,f,b,v,P,g,w,E,T,R,y,z,L,C,x,D;const O=this._projectors.find((t=>t.name===e));(null===(t=O.lightBoundLT)||void 0===t?void 0:t.geometry)&&(null===(o=O.lightBoundLT)||void 0===o||o.geometry.dispose()),(null===(i=O.lightBoundLT)||void 0===i?void 0:i.object)&&this._scene.remove(null===(s=O.lightBoundLT)||void 0===s?void 0:s.object),(null===(r=O.lightBoundRT)||void 0===r?void 0:r.geometry)&&(null===(n=O.lightBoundRT)||void 0===n||n.geometry.dispose()),(null===(a=O.lightBoundRT)||void 0===a?void 0:a.object)&&this._scene.remove(null===(h=O.lightBoundRT)||void 0===h?void 0:h.object),(null===(c=O.lightBoundLB)||void 0===c?void 0:c.geometry)&&(null===(l=O.lightBoundLB)||void 0===l||l.geometry.dispose()),(null===(d=O.lightBoundLB)||void 0===d?void 0:d.object)&&this._scene.remove(null===(_=O.lightBoundLB)||void 0===_?void 0:_.object),(null===(m=O.lightBoundRB)||void 0===m?void 0:m.geometry)&&(null===(u=O.lightBoundRB)||void 0===u||u.geometry.dispose()),(null===(p=O.lightBoundRB)||void 0===p?void 0:p.object)&&this._scene.remove(null===(S=O.lightBoundRB)||void 0===S?void 0:S.object),(null===(j=O.screenBoundL)||void 0===j?void 0:j.geometry)&&(null===(f=O.screenBoundL)||void 0===f||f.geometry.dispose()),(null===(b=O.screenBoundL)||void 0===b?void 0:b.object)&&this._scene.remove(null===(v=O.screenBoundL)||void 0===v?void 0:v.object),(null===(P=O.screenBoundR)||void 0===P?void 0:P.geometry)&&(null===(g=O.screenBoundR)||void 0===g||g.geometry.dispose()),(null===(w=O.screenBoundR)||void 0===w?void 0:w.object)&&this._scene.remove(null===(E=O.screenBoundR)||void 0===E?void 0:E.object),(null===(T=O.screenBoundT)||void 0===T?void 0:T.geometry)&&(null===(R=O.screenBoundT)||void 0===R||R.geometry.dispose()),(null===(y=O.screenBoundT)||void 0===y?void 0:y.object)&&this._scene.remove(null===(z=O.screenBoundT)||void 0===z?void 0:z.object),(null===(L=O.screenBoundB)||void 0===L?void 0:L.geometry)&&(null===(C=O.screenBoundB)||void 0===C||C.geometry.dispose()),(null===(x=O.screenBoundB)||void 0===x?void 0:x.object)&&this._scene.remove(null===(D=O.screenBoundB)||void 0===D?void 0:D.object)}_createBoundLine(e){const t=this._projectors.find((t=>t.name===e)),o=$.default.state.projector.projectors.find((t=>t.uId===e)),i=$.default.state.projector.selectedProjectorUid===e;if(!t||!o)return;this._disposeBoundLine(e);const s=1/o.throwRatio/o.aspectRatio/2,r=1+(2*o.lensShiftV+o.offset)/100,n=180*Math.atan(s*r)/Math.PI,a=1-(2*o.lensShiftV+o.offset)/100,h=180*Math.atan(s*a)/Math.PI,c=1/o.throwRatio/2,l=1+2*o.lensShiftH/100,d=180*Math.atan(c*l)/Math.PI,_=1-2*o.lensShiftH/100,m=180*Math.atan(c*_)/Math.PI,u=new H.Pa4;u.set(Math.tan(m*Math.PI/180),Math.tan(n*Math.PI/180),1);const p=u.clone();this._applayDirectionRotation(u,t);const S=new H.Pa4;S.set(-Math.tan(d*Math.PI/180),Math.tan(n*Math.PI/180),1);const j=S.clone();this._applayDirectionRotation(S,t);const f=new H.Pa4;f.set(Math.tan(m*Math.PI/180),-Math.tan(h*Math.PI/180),1);const b=f.clone();this._applayDirectionRotation(f,t);const v=new H.Pa4;v.set(-Math.tan(d*Math.PI/180),-Math.tan(h*Math.PI/180),1);const P=v.clone();this._applayDirectionRotation(v,t),t.lightBoundLT=this._createRayLine(t.position,u,i),t.lightBoundRT=this._createRayLine(t.position,S,i),t.lightBoundLB=this._createRayLine(t.position,f,i),t.lightBoundRB=this._createRayLine(t.position,v,i),t.screenBoundL=this._createScreenBoundLine(t.position,p,b,"y",t,i),t.screenBoundR=this._createScreenBoundLine(t.position,j,P,"y",t,i),t.screenBoundT=this._createScreenBoundLine(t.position,p,j,"x",t,i),t.screenBoundB=this._createScreenBoundLine(t.position,b,P,"x",t,i)}_applayDirectionRotation(e,t){const o=new H.Pa4(1,0,0),i=new H.Pa4(0,1,0),s=new H.Pa4(0,0,1);e.applyAxisAngle(o,t.rotation.x),e.applyAxisAngle(i,t.rotation.y),e.applyAxisAngle(s,t.rotation.z)}_createScreenBoundLine(e,t,o,i,s,r){const n=[],a=50,h=new H.Pa4(1,0,0),c=new H.Pa4(0,1,0),l=new H.Pa4(0,0,1),d=(t[i]-o[i])/a;for(let u=0;u<=a+1;u++){const o=t.clone();o[i]-=d*u,o.applyAxisAngle(h,s.rotation.x),o.applyAxisAngle(c,s.rotation.y),o.applyAxisAngle(l,s.rotation.z);const r=this._calcHitPoint(e,o);n.push(r)}const _={geometry:null,object:null};_.geometry=new U.VJ,_.geometry.setPoints(n);const m=new U.r7({color:15689814,lineWidth:1,transparent:!r,opacity:.6});return _.object=new H.Kj0(_.geometry,m),this._scene.add(_.object),_}_createRayLine(e,t,o){const i=this._calcHitPoint(e,t),s=[e,i],r={geometry:null,object:null};r.geometry=new U.VJ,r.geometry.setPoints(s);const n=new U.r7({color:5263438,lineWidth:o?.5:.2,transparent:!o,opacity:.5});return r.object=new H.Kj0(r.geometry,n),this._scene.add(r.object),r}_createAllBoundLine(){this._projectors.forEach((e=>{this._createBoundLine(e.name)}))}_calcHitPoint(e,t){const o=new H.iMs(e,t.normalize()),i=[this._room.objects.back,this._room.objects.front,this._room.objects.left,this._room.objects.right,this._room.objects.top,this._room.objects.bottom,this._screen.object],s=o.intersectObjects(i);return 0===s.length?null:s[0].point}}class X extends q{constructor(e){super(),this._init(e)}_init(e){this._initRenderer(e),this._initScene(),this._initControls(),this._initTransformControl(),this._initTexture().then((()=>{this._initRoom(),this._initScreen()})),this.setTheme()}setScreen(e){this._screenType=e,this._initScreen(),this._screen.object.updateMatrixWorld(),this._createAllBoundLine()}setRoomSize(){this._initRoom(),this._initLight()}setScreenPosition(){this._screen.object.position.x=$.default.state.screen.x*this._roomSize.ratio,this._screen.object.position.y=$.default.state.screen.y*this._roomSize.ratio,this._screen.object.position.z=$.default.state.screen.z*this._roomSize.ratio,this._screen.object.rotation.x=$.default.state.screen.rotateX/180*Math.PI,this._screen.object.rotation.y=$.default.state.screen.rotateY/180*Math.PI,this._screen.object.rotation.z=$.default.state.screen.rotateZ/180*Math.PI,this._screen.object.updateMatrixWorld(),this._createAllBoundLine()}addProjector(e){this._addProjecotr(e).then((e=>{this._projectors.push(e),$.default.commit("projector/SET_SELECTED_PROJECTOR_X",e.position.x/this._roomSize.ratio),$.default.commit("projector/SET_SELECTED_PROJECTOR_Y",e.position.y/this._roomSize.ratio),$.default.commit("projector/SET_SELECTED_PROJECTOR_Z",e.position.z/this._roomSize.ratio),this._createAllBoundLine()}))}setProjector(e){this._setTransformControl(e.uId);const t=this._projectors.find((t=>t.name===e.uId));t.position.x=e.x*this._roomSize.ratio,t.position.y=e.y*this._roomSize.ratio,t.position.z=e.z*this._roomSize.ratio,t.rotation.x=e.rotateX/180*Math.PI,t.rotation.y=e.rotateY/180*Math.PI,t.rotation.z=e.rotateZ/180*Math.PI,this._createAllBoundLine()}deleteProjector(e){const t=this._projectors.find((t=>t.name===e));this._transformControl.object===t&&this._transformControl.detach(),this._disposeBoundLine(e),this._scene.remove(t)}}let K=null;const F={name:"PageIndex",components:{ProjectorDetail:A},created(){this.$bus.on("setScreen",this.setScreen),this.$bus.on("setScreenPosition",this.setScreenPosition),this.$bus.on("autoAdjustScreenPosition",this.autoAdjustScreenPosition),this.$bus.on("setRoomSize",this.setRoomSize),this.$bus.on("addProjector",this.addProjector),this.$bus.on("setProjector",this.setProjector),this.$bus.on("deleteProjector",this.deleteProjector)},beforeUnmount(){this.$bus.off("setScreen",this.setScreen),this.$bus.off("setScreenPosition",this.setScreenPosition),this.$bus.off("autoAdjustScreenPosition",this.autoAdjustScreenPosition),this.$bus.off("setRoomSize",this.setRoomSize),this.$bus.off("addProjector",this.addProjector),this.$bus.off("setProjector",this.setProjector),this.$bus.off("deleteProjector",this.deleteProjector)},mounted(){K=new X("#threeView"),K.animate()},data(){return{view:null}},methods:{stylePage(e,t){return{height:t-e+"px"}},resizeCanvas(){K.onWindowResize()},setRoomSize(){K.setRoomSize()},setScreen(e){K.setScreen(e)},setScreenPosition(){K.setScreenPosition()},autoAdjustScreenPosition(){K.adjustScreenPosition()},addProjector(e){K.addProjector(e)},setProjector(e){K.setProjector(e)},deleteProjector(e){K.deleteProjector(e)}}};var N=o(4379),Q=o(5151);F.render=n,F.__scopeId="data-v-6496bb0b";const G=F;I()(F,"components",{QPage:N.Z,QResizeObserver:Q.Z})}}]);