"use strict";(self["webpackChunkmps"]=self["webpackChunkmps"]||[]).push([[408],{52934:(e,t,o)=>{o.d(t,{UF:()=>i,OO:()=>s,jT:()=>r});const i={m:0,cm:1,mm:2,inch:3,feet:4},s={m:1,cm:100,mm:1e3,inch:39.3700787,feet:3.2808399},r={plane:0,curved:1,sphere:2,custom:3}},63898:(e,t,o)=>{o.d(t,{u:()=>i});class i{constructor(){this.uId="",this.customName="",this.modelName="",this.lensName="",this.aspectRatio=0,this.imageAspectRatio=0,this.offset=0,this.texture="",this.throwRatio=0,this.throwRatioMin=0,this.throwRatioMax=0,this.x=0,this.y=0,this.z=0,this.projectionDistance=0,this.ambientContrast=1,this.brightnessOnScreenNit=1,this.rotateX=0,this.rotateY=0,this.rotateZ=0,this.lensShiftH=0,this.lensShiftHMin=0,this.lensShiftHMax=0,this.lensShiftV=0,this.lensShiftVMin=0,this.lensShiftVMax=0,this.isShowBlendingGuideLine=!1,this.blendingGuideLineL=0,this.blendingGuideLineR=0,this.blendingGuideLineT=0,this.blendingGuideLineB=0,this.resolutionX=0,this.resolutionY=0}}},64750:(e,t,o)=>{o.d(t,{i0:()=>n,wp:()=>a,Sv:()=>c,x$:()=>l,gh:()=>u,vc:()=>m});o(10071),o(17965),o(67280),o(60979),o(76105),o(12396);var i=o(56417),s=o(13991),r=o(44241);function n(e,t,o,s){i.Z.create({message:e,color:"primary",position:"top",actions:[{label:t,color:"yellow",handler:()=>{s()}},{label:o,color:"white",handler:()=>{}}]})}function a(e,t){i.Z.create({message:e,color:"negative",position:"top",actions:[{label:t,color:"yellow",handler:()=>{}}]})}const c=(e,t)=>{const o=document.createElement("a"),i=h(t),s=document.createEvent("HTMLEvents");s.initEvent("click",!0,!0),o.download=e,o.href=URL.createObjectURL(i),o.click(),o.remove()},h=e=>{const t=e.split(";base64,"),o=t[0].split(":")[1],i=window.atob(t[1]),s=i.length,r=new Uint8Array(s);for(let n=0;n<s;++n)r[n]=i.charCodeAt(n);return new Blob([r],{type:o})},l=(e,t)=>{void 0===t&&(t={});const o=t.fontface?t.fontface:"Arial",i=t.fontsize?t.fontsize:18,r=t.borderThickness?t.borderThickness:2,n=t.borderColor?t.borderColor:{r:0,g:0,b:0,a:1},a=t.hasOwnProperty?t.backgroundColor:{r:255,g:255,b:255,a:1},c=document.createElement("canvas");c.width=1e3;const h=c.getContext("2d");h.font="Bold "+i+"px "+o;const l=h.measureText(e),u=l.width;h.fillStyle="rgba("+a.r+","+a.g+","+a.b+","+a.a+")",h.strokeStyle="rgba("+n.r+","+n.g+","+n.b+","+n.a+")",h.lineWidth=r,d(h,r/2,r/2,u+r,1.4*i+r,4),h.fillStyle="rgba(255, 255, 255, 1.0)",h.fillText(e,r,i+r);const m=new s.xEZ(c);m.needsUpdate=!0;const _=new s.xeV({map:m}),p=new s.jyi(_);return p.scale.set(30,5,0),p},d=(e,t,o,i,s,r)=>{e.beginPath(),e.moveTo(t+r,o),e.lineTo(t+i-r,o),e.quadraticCurveTo(t+i,o,t+i,o+r),e.lineTo(t+i,o+s-r),e.quadraticCurveTo(t+i,o+s,t+i-r,o+s),e.lineTo(t+r,o+s),e.quadraticCurveTo(t,o+s,t,o+s-r),e.lineTo(t,o+r),e.quadraticCurveTo(t,o,t+r,o),e.closePath(),e.fill(),e.stroke()},u=e=>{const t=r.default.state.projector.projectors.find((t=>t.uId===e));if(!t)return 1;const o=t.projectionDistance/t.throwRatio,i=o/t.aspectRatio,s=o*i,n=r.default.state.projector.projectorModels.vvkProjectorModels.find((e=>e.ModelName===t.modelName)).Brightness.value,a=n/s,c=(a+r.default.state.room.brightness)/r.default.state.room.brightness;return c.toFixed(2)},m=e=>{const t=r.default.state.projector.projectors.find((t=>t.uId===e));if(!t)return 1;const o=t.projectionDistance/t.throwRatio,i=o/t.aspectRatio,s=o*i,n=r.default.state.projector.projectorModels.vvkProjectorModels.find((e=>e.ModelName===t.modelName)).Brightness.value,a=n/s,c=a*r.default.state.screen.screenGain/Math.PI;return c.toFixed(1)}},92408:(e,t,o)=>{o.r(t),o.d(t,{default:()=>J});var i=o(83673);const s=(0,i.HX)("data-v-ebd4bd44");(0,i.dD)("data-v-ebd4bd44");const r={class:"fit",id:"threeView"},n=(0,i.Uk)(" Projector View ");(0,i.Cn)();const a=s(((e,t,o,a,c,h)=>{const l=(0,i.up)("q-tooltip"),d=(0,i.up)("q-btn"),u=(0,i.up)("ProjectorDetail"),m=(0,i.up)("q-resize-observer"),_=(0,i.up)("q-page");return(0,i.wg)(),(0,i.j4)(_,{class:"flex flex-center","style-fn":h.stylePage},{default:s((()=>[(0,i.Wm)("div",r,[(0,i.Wm)(d,{push:"",icon:"videocam",color:"white","text-color":"primary",class:"absolute-top-left q-ma-md",onMousedown:h.changeCamera,onMouseup:h.resetCamera},{default:s((()=>[(0,i.Wm)(l,null,{default:s((()=>[n])),_:1})])),_:1},8,["onMousedown","onMouseup"]),(0,i.Wm)(u),(0,i.Wm)(m,{onResize:h.resizeCanvas,debounce:"100"},null,8,["onResize"])])])),_:1},8,["style-fn"])}));var c=o(90515),h=o.n(c),l=o(87874),d=o(62323),u=o(98880);const m=(0,i.HX)("data-v-3f71818e");(0,i.dD)("data-v-3f71818e");const _={class:"absolute absolute-bottom-left detail-wrapper"},p={key:0,style:{color:"#2196f3"}},g={key:1};(0,i.Cn)();const b=m(((e,t,o,s,r,n)=>{const a=(0,i.up)("q-td"),c=(0,i.up)("q-table"),h=(0,i.up)("q-card");return(0,i.wy)(((0,i.wg)(),(0,i.j4)("div",_,[(0,i.Wm)(h,{class:"fit"},{default:m((()=>[(0,i.Wm)(c,{onRowClick:n.clickRow,selected:n.selectedRows,"onUpdate:selected":t[1]||(t[1]=e=>n.selectedRows=e),rows:n.projectors,columns:n.columns,"row-key":"uId",class:"my-sticky-header-table",selection:"multiple",pagination:{rowsPerPage:100},"hide-bottom":"",dense:"",flat:"",bordered:"",square:""},{"body-cell":m((e=>[(0,i.Wm)(a,{props:e},{default:m((()=>[e.row.uId===n.selectedProjector.uId?((0,i.wg)(),(0,i.j4)("span",p,(0,d.zw)(e.value),1)):((0,i.wg)(),(0,i.j4)("span",g,(0,d.zw)(e.value),1))])),_:2},1032,["props"])])),_:1},8,["onRowClick","selected","rows","columns"])])),_:1})],512)),[[u.F8,n.showProjectorDetail]])}));var f=o(11185),j=o(63898);const S={name:"Projector-Table",data(){return{}},computed:{unitLabel(){return this.$store.state.common.unitLabel},selectedRows:{get(){return this.$store.state.projector.selectedProjectors},set(e){this.SET_SELECTED_PROJECTORS(e)}},columns(){return[{name:"customName",required:!0,label:"customName",field:"customName",align:"left"},{name:"modelName",required:!0,label:"modelName",field:"modelName",align:"left"},{name:"lensName",required:!0,label:"lensName",field:"lensName",align:"left",format:e=>`${e||"fixed"}`},{name:"x",required:!0,label:`x(${this.unitLabel})`,field:"x",align:"left",format:e=>Number(e).toFixed(2)},{name:"y",required:!0,label:`y(${this.unitLabel})`,field:"y",align:"left",format:e=>Number(e).toFixed(2)},{name:"z",required:!0,label:`z(${this.unitLabel})`,field:"z",align:"left",format:e=>Number(e).toFixed(2)},{name:"rotateX",required:!0,label:"rotateX(°)",field:"rotateX",align:"left"},{name:"rotateY",required:!0,label:"rotateY(°)",field:"rotateY",align:"left"},{name:"rotateZ",required:!0,label:"rotateZ(°)",field:"rotateZ",align:"left"},{name:"throwRatio",required:!0,label:"throwRatio",field:"throwRatio",align:"left"},{name:"lensShiftH",required:!0,label:"lensShiftH(%)",field:"lensShiftH",align:"left"},{name:"lensShiftV",required:!0,label:"lensShiftV(%)",field:"lensShiftV",align:"left"},{name:"brightnessOnScreenNit",required:!0,label:"Brightness On Screen Nit",field:"brightnessOnScreenNit",align:"left"},{name:"ambientContrast",required:!0,label:"Ambient Contrast",field:"ambientContrast",align:"left",format:e=>`${e}:1`}]},projectors(){return this.$store.state.projector.projectors},showProjectorDetail(){return this.$store.state.common.showProjectorDetail},selectedProjector(){return this.$store.getters["projector/selectedProjector"]}},methods:h()(h()({},(0,l.OI)("projector",["SET_SELECTED_PROJECTOR_UID","ADD_PROJECTOR","SET_SELECTED_PROJECTORS"])),{},{copyProjector(){const e=new j.u;Object.keys(this.selectedProjector).forEach((t=>{e[t]=this.selectedProjector[t]})),e.uId=(0,f.Z)(),e.customName=`${e.customName}(copy-${e.uId.slice(0,4)})`,this.ADD_PROJECTOR(e),this.$bus.emit("addProjector",e.uId)},clickRow(e,t,o){this.SET_SELECTED_PROJECTOR_UID(t.uId),this.$bus.emit("setProjector",t)}})};var v=o(10151),w=o(36429),y=o(83884),P=o(7518),T=o.n(P);S.render=b,S.__scopeId="data-v-3f71818e";const R=S;T()(S,"components",{QCard:v.Z,QTable:w.Z,QTd:y.Z});var z=o(44241),E=(o(10071),o(60979),o(1118),o(12396),o(75691)),L=o(52483),C=o(57742),x=o(45810),B=o(13991),D=o(35389),M=o(29058),I=o(52934),O=o(64750);class A{constructor(){this._renderer=null,this._dom=null,this._camera=null,this._scene=null,this._light=null,this._raycaster=new B.iMs,this._mouse=new B.FM8,this._hotProjectorUid="",this._currentHitPoint=new B.Pa4(0,0,0),this._currentHitDirection=new B.Pa4(0,0,0),this._projectors=[],this._textures={},this._texture={wall:null,floor:null},this._room={material:{front:null,back:null,left:null,right:null,top:null,bottom:null},geometrys:{front:null,back:null,left:null,right:null,top:null,bottom:null},objects:{front:null,back:null,left:null,right:null,top:null,bottom:null}},this._roomSize={width:0,height:0,depth:0,widthDraw:0,heightDraw:0,depthDraw:0,ratio:10},this._screenType=I.jT.plane,this._screen={material:null,geometry:null,object:null},this._planeScreen={diagonal:0,aspectRatio:0},this._curvedScreen={diagonal:0,aspectRatio:0,radius:0,radialSegments:3,isSmooth:!0},this._sphereScreen={radius:0,phiStart:0,phiLength:100},this._customScreen={geometry:"",material:""},this._controls=null}_initRenderer(e){this._renderer=new B.CP7,this._dom=document.querySelector(e),this._dom.appendChild(this._renderer.domElement);const t=this._dom.getBoundingClientRect();this._renderer.setSize(t.width,t.height+20),this._initCamera(t),this._dom.addEventListener("mousemove",(e=>{this._onMouseMove(e)}),!1),this._dom.addEventListener("mousedown",(()=>{this._onMouseDown()}),!1)}onWindowResize(){const e=this._dom.getBoundingClientRect();this._camera.aspect=e.width/e.height,this._camera.updateProjectionMatrix(),this._renderer.setSize(e.width,e.height)}_onMouseMove(e){const t=this._dom.getBoundingClientRect();this._mouse.x=e.offsetX/t.width*2-1,this._mouse.y=-e.offsetY/t.height*2+1}_onMouseDown(){this._hotProjectorUid&&(z.default.commit("projector/SET_SELECTED_PROJECTOR_UID",this._hotProjectorUid),this._setTransformControl(this._hotProjectorUid),this._createAllBoundLine())}_setTransformControl(e){const t=this._projectors.find((t=>t.name===e));this._transformControl.object!==t&&this._transformControl.attach(t)}_initCamera(e){this._camera=new B.cPb(40,e.width/e.height,.1,1e3),this._camera.position.set(25.8,29.5,-102.8),this._camera.lookAt(0,0,0)}_initScene(){this._scene=new B.xsS,this._initLight(),this.setTheme()}_initLight(){this._roomSize.depth=z.default.state.room.depth,this._roomSize.depthDraw=this._roomSize.depth*this._roomSize.ratio,this._light?this._light.position.set(0,0,this._roomSize.depthDraw/2):(this._light=new B.cek(16777215,1.2,0,2),this._light.position.set(0,0,this._roomSize.depthDraw/2),this._scene.add(this._light))}_initControls(){this._controls=new E.z(this._camera,this._renderer.domElement),this._controls.addEventListener("change",(()=>{}))}_initTransformControl(){this._transformControl=new L.Ys(this._camera,this._renderer.domElement),this._transformControl.size=.5,this._transformControl.addEventListener("dragging-changed",(e=>{this._controls.enabled=!e.value}));let e=0;this._transformControl.addEventListener("change",(t=>{e++,e%2===0&&this._transformControl.object&&(z.default.commit("projector/SET_SELECTED_PROJECTOR_X",this._transformControl.object.position.x/this._roomSize.ratio),z.default.commit("projector/SET_SELECTED_PROJECTOR_Y",this._transformControl.object.position.y/this._roomSize.ratio),z.default.commit("projector/SET_SELECTED_PROJECTOR_Z",this._transformControl.object.position.z/this._roomSize.ratio),this._createBoundLine(this._transformControl.object.name),this._transformControl.object.customLabel.position.set(this._transformControl.object.position.x,this._transformControl.object.position.y,this._transformControl.object.position.z))})),this._scene.add(this._transformControl)}_render(){this._raycaster.setFromCamera(this._mouse,this._camera),this._hotProjectorUid=null,this._projectors.forEach((e=>{const t=this._raycaster.intersectObjects(e.children);t.length>0?e.children.forEach((t=>{t.material.emissive.setHex(255),this._hotProjectorUid=e.name})):e.children.forEach((e=>{e.material.emissive.setHex(0)}))})),this._renderer.render(this._scene,this._camera)}setTheme(){this._scene.background=M.Z.isActive?new B.Ilk(1250327):new B.Ilk(16776427)}animate(){requestAnimationFrame((()=>{this.animate()})),this._render()}_initTexture(){const e=new B.dpR,t=new Promise(((t,o)=>{e.load("texture/wall.jfif",(e=>{const o=new B.YBo({map:e,side:B.Wl3,emissive:16711422,emissiveIntensity:.2});this._room.material.front=o,this._room.material.back=o,this._room.material.left=o,this._room.material.right=o,this._room.material.top=o,t(e)}),null,(e=>{o(e)}))})),o=new Promise(((t,o)=>{e.load("texture/floor.jfif",(e=>{const o=new B.YBo({map:e,side:B.Wl3,emissive:16711422,emissiveIntensity:.2});this._room.material.bottom=o,t(e)}),null,(e=>{o(e)}))})),i=new Promise(((t,o)=>{e.load("texture/screen2.jpg",(e=>{const o=new B.vBJ({map:e,side:B.ehD,transparent:!0,opacity:.8});this._screen.material=o,t(e)}),null,(e=>{o(e)}))}));return Promise.all([t,o,i])}_loadTexture(e,t){const o=new B.dpR;return new Promise(((i,s)=>{if(t){const t=document.createElement("video");t.src=e,t.style.width="0px",t.autoplay=!0,t.muted=!0,t.loop=!0,t.controls=!0;const o=document.getElementById("textureVideo");o.appendChild(t);const s=new B.fO1(t);i(s)}else o.load(e,(e=>{i(e)}),null,(e=>{s(e)}))}))}_initRoom(){this._roomSize.width=z.default.state.room.width,this._roomSize.height=z.default.state.room.height,this._roomSize.depth=z.default.state.room.depth,this._roomSize.widthDraw=this._roomSize.width*this._roomSize.ratio,this._roomSize.heightDraw=this._roomSize.height*this._roomSize.ratio,this._roomSize.depthDraw=this._roomSize.depth*this._roomSize.ratio,this._room&&(Object.values(this._room.geometrys).forEach((e=>{e&&e.dispose()})),Object.values(this._room.objects).forEach((e=>{e&&this._scene.remove(e)}))),this._room.geometrys.front=new B._12(this._roomSize.widthDraw,this._roomSize.heightDraw),this._room.objects.front=new B.Kj0(this._room.geometrys.front,this._room.material.front),this._room.objects.front.position.z=this._roomSize.depthDraw,this._room.objects.front.rotateY(1*Math.PI),this._scene.add(this._room.objects.front),this._room.geometrys.back=new B._12(this._roomSize.widthDraw,this._roomSize.heightDraw),this._room.objects.back=new B.Kj0(this._room.geometrys.back,this._room.material.back),this._scene.add(this._room.objects.back),this._room.geometrys.top=new B._12(this._roomSize.widthDraw,this._roomSize.depthDraw),this._room.objects.top=new B.Kj0(this._room.geometrys.top,this._room.material.top),this._room.objects.top.position.z=this._roomSize.depthDraw/2,this._room.objects.top.position.y=this._roomSize.heightDraw/2,this._room.objects.top.rotateX(.5*Math.PI),this._scene.add(this._room.objects.top),this._room.geometrys.bottom=new B._12(this._roomSize.widthDraw,this._roomSize.depthDraw),this._room.objects.bottom=new B.Kj0(this._room.geometrys.bottom,this._room.material.bottom),this._room.objects.bottom.position.z=this._roomSize.depthDraw/2,this._room.objects.bottom.position.y=-this._roomSize.heightDraw/2,this._room.objects.bottom.rotateX(-.5*Math.PI),this._scene.add(this._room.objects.bottom),this._room.geometrys.left=new B._12(this._roomSize.depthDraw,this._roomSize.heightDraw),this._room.objects.left=new B.Kj0(this._room.geometrys.left,this._room.material.left),this._room.objects.left.position.z=this._roomSize.depthDraw/2,this._room.objects.left.position.x=this._roomSize.widthDraw/2,this._room.objects.left.rotateY(-.5*Math.PI),this._scene.add(this._room.objects.left),this._room.geometrys.right=new B._12(this._roomSize.depthDraw,this._roomSize.heightDraw),this._room.objects.right=new B.Kj0(this._room.geometrys.right,this._room.material.right),this._room.objects.right.position.z=this._roomSize.depthDraw/2,this._room.objects.right.position.x=-this._roomSize.widthDraw/2,this._room.objects.right.rotateY(.5*Math.PI),this._scene.add(this._room.objects.right)}_initScreen(){this._screen.geometry&&this._screen.geometry.dispose(),this._screen.object&&this._scene.remove(this._screen.object),this._screenType===I.jT.plane&&this._createPlaneScreen(),this._screenType===I.jT.curved&&this._createCurveScreen(),this._screenType===I.jT.sphere&&this._createSphereScreen(),this._screenType===I.jT.custom&&this._createCustomScreen(),this.adjustScreenPosition()}adjustScreenPosition(){const e=this._screen.geometry.attributes.position.array,t=this._screen.geometry.attributes.position.count;let o=0,i=0,s=0,r=0,n=0;for(let a=0;a<t;a++){const[t,c,h]=[e[3*a],e[3*a+1],e[3*a+2]];t<o&&(o=t),t>i&&(i=t),c<s&&(s=c),c>r&&(r=c),h>n&&(n=h)}this._screen.object.position.x=this._roomSize.widthDraw/2-i-(o- -this._roomSize.widthDraw/2),this._screen.object.position.y=this._roomSize.heightDraw/2-r-(s- -this._roomSize.heightDraw/2),this._screen.object.position.z=this._roomSize.depthDraw-n-.5*this._roomSize.ratio,this._screen.object.position.x=0,this._screen.object.position.y=0,this._screen.object.position.z=this._roomSize.depthDraw-n-1*this._roomSize.ratio,z.default.commit("screen/SET_X",this._screen.object.position.x/this._roomSize.ratio),z.default.commit("screen/SET_Y",this._screen.object.position.y/this._roomSize.ratio),z.default.commit("screen/SET_Z",this._screen.object.position.z/this._roomSize.ratio),z.default.commit("screen/SET_ROTATE_X",this._screen.object.rotation.x/Math.PI*180),z.default.commit("screen/SET_ROTATE_Y",this._screen.object.rotation.y/Math.PI*180),z.default.commit("screen/SET_ROTATE_Z",this._screen.object.rotation.z/Math.PI*180),this._screen.object.updateMatrixWorld(),this._createAllBoundLine()}_createPlaneScreen(){this._planeScreen.diagonal=z.default.state.screen.plane.diagonal,this._planeScreen.aspectRatio=z.default.state.screen.plane.aspectRatio,0===this._planeScreen.aspectRatio&&(this._planeScreen.aspectRatio=z.default.state.screen.plane.width/z.default.state.screen.plane.height);const e=this._planeScreen.diagonal/I.OO.inch,t=Math.atan(this._planeScreen.aspectRatio),o=e*Math.sin(t),i=o/this._planeScreen.aspectRatio;this._screen.geometry=new B._12(o*this._roomSize.ratio,i*this._roomSize.ratio),this._screen.object=new B.Kj0(this._screen.geometry,this._screen.material),this._scene.add(this._screen.object)}_createCurveScreen(){this._curvedScreen.diagonal=z.default.state.screen.curved.diagonal,this._curvedScreen.aspectRatio=z.default.state.screen.curved.aspectRatio,this._curvedScreen.radius=z.default.state.screen.curved.radius*this._roomSize.ratio,this._curvedScreen.radialSegments=z.default.state.screen.curved.radialSegments,this._curvedScreen.isSmooth=z.default.state.screen.curved.isSmooth,0===this._curvedScreen.aspectRatio&&(this._curvedScreen.aspectRatio=z.default.state.screen.curved.width/z.default.state.screen.curved.height);const e=this._curvedScreen.diagonal/I.OO.inch,t=Math.atan(this._curvedScreen.aspectRatio),o=e*Math.sin(t),i=o/this._curvedScreen.aspectRatio,s=o*this._roomSize.ratio/this._curvedScreen.radius;this._screen.geometry=new B.fHI(this._curvedScreen.radius,this._curvedScreen.radius,i*this._roomSize.ratio,this._curvedScreen.isSmooth?128:this._curvedScreen.radialSegments,1,!0,-s/2,s),this._screen.object=new B.Kj0(this._screen.geometry,this._screen.material),this._scene.add(this._screen.object)}_createSphereScreen(){this._sphereScreen.radius=z.default.state.screen.sphere.radius*this._roomSize.ratio,this._sphereScreen.phiStart=z.default.state.screen.sphere.phiStart/180*Math.PI,this._sphereScreen.phiLength=z.default.state.screen.sphere.phiLength/180*Math.PI,this._sphereScreen.thetaStart=z.default.state.screen.sphere.thetaStart/180*Math.PI,this._sphereScreen.thetaLength=(1-z.default.state.screen.sphere.thetaEnd/180-z.default.state.screen.sphere.thetaStart/180)*Math.PI,this._screen.geometry=new B.xo$(this._sphereScreen.radius,16,16,this._sphereScreen.phiStart,this._sphereScreen.phiLength,this._sphereScreen.thetaStart,this._sphereScreen.thetaLength),this._screen.object=new B.Kj0(this._screen.geometry,this._screen.material),this._scene.add(this._screen.object)}_createCustomScreen(){const e=z.default.state.screen.custom.geometrySrc,t=z.default.state.screen.custom.materialSrc;if(""===e)return void(this._screen.object=new B.Kj0);const o=new x.v,i=new C.L;o.loadAsync(t).then((t=>{i.setMaterials(t),i.loadAsync(e).then((e=>{e.children.forEach((e=>{e.geometry.computeBoundingBox(),e.geometry.center()})),e.isScreen=!0,this._screen.object=e,this._scene.add(e),this.adjustScreenPosition()}))}))}_addProjecotr(e){const t=new x.v,o=new C.L,i=new Promise(((i,s)=>{t.load("models/H7T_Laset7.mtl",(t=>{o.setMaterials(t),o.load("models/H7T_Laset7.obj",(t=>{t.children.forEach((e=>{e.geometry.computeBoundingBox(),e.geometry.center()})),t.name=e,t.position.z=this._roomSize.depthDraw/2,t.customLabel=(0,O.x$)(z.default.getters["projector/selectedProjector"].customName,{fontsize:80,borderColor:{r:255,g:255,b:255,a:1},backgroundColor:{r:255,g:0,b:0,a:.6}}),t.customLabel.center=new B.FM8(0,0),this._scene.add(t.customLabel),t.customLabel.position.set(t.position.x,t.position.y,t.position.z),this._scene.add(t),this._transformControl.attach(t),i(t)}),void 0,(e=>{s(e)}))}),void 0,(e=>{s(e)}))}));return i}_disposeBoundLine(e){var t,o,i,s,r,n,a,c,h,l,d,u,m,_,p,g,b,f,j,S,v,w,y,P,T,R,z,E,L,C,x,B,D,M,I,O,A,k,G,$,H,N,q,V,J,Z,U,W,Y,X,F,K,Q,ee,te,oe;const ie=this._projectors.find((t=>t.name===e));(null===(t=ie.lightBoundLT)||void 0===t?void 0:t.geometry)&&(null===(o=ie.lightBoundLT)||void 0===o||o.geometry.dispose()),(null===(i=ie.lightBoundLT)||void 0===i?void 0:i.object)&&this._scene.remove(null===(s=ie.lightBoundLT)||void 0===s?void 0:s.object),(null===(r=ie.lightBoundRT)||void 0===r?void 0:r.geometry)&&(null===(n=ie.lightBoundRT)||void 0===n||n.geometry.dispose()),(null===(a=ie.lightBoundRT)||void 0===a?void 0:a.object)&&this._scene.remove(null===(c=ie.lightBoundRT)||void 0===c?void 0:c.object),(null===(h=ie.lightBoundLB)||void 0===h?void 0:h.geometry)&&(null===(l=ie.lightBoundLB)||void 0===l||l.geometry.dispose()),(null===(d=ie.lightBoundLB)||void 0===d?void 0:d.object)&&this._scene.remove(null===(u=ie.lightBoundLB)||void 0===u?void 0:u.object),(null===(m=ie.lightBoundRB)||void 0===m?void 0:m.geometry)&&(null===(_=ie.lightBoundRB)||void 0===_||_.geometry.dispose()),(null===(p=ie.lightBoundRB)||void 0===p?void 0:p.object)&&this._scene.remove(null===(g=ie.lightBoundRB)||void 0===g?void 0:g.object),(null===(b=ie.lightBoundC)||void 0===b?void 0:b.geometry)&&(null===(f=ie.lightBoundC)||void 0===f||f.geometry.dispose()),(null===(j=ie.lightBoundC)||void 0===j?void 0:j.object)&&this._scene.remove(null===(S=ie.lightBoundC)||void 0===S?void 0:S.object),(null===(v=ie.screenBoundL)||void 0===v?void 0:v.geometry)&&(null===(w=ie.screenBoundL)||void 0===w||w.geometry.dispose()),(null===(y=ie.screenBoundL)||void 0===y?void 0:y.object)&&this._scene.remove(null===(P=ie.screenBoundL)||void 0===P?void 0:P.object),(null===(T=ie.screenBoundR)||void 0===T?void 0:T.geometry)&&(null===(R=ie.screenBoundR)||void 0===R||R.geometry.dispose()),(null===(z=ie.screenBoundR)||void 0===z?void 0:z.object)&&this._scene.remove(null===(E=ie.screenBoundR)||void 0===E?void 0:E.object),(null===(L=ie.screenBoundT)||void 0===L?void 0:L.geometry)&&(null===(C=ie.screenBoundT)||void 0===C||C.geometry.dispose()),(null===(x=ie.screenBoundT)||void 0===x?void 0:x.object)&&this._scene.remove(null===(B=ie.screenBoundT)||void 0===B?void 0:B.object),(null===(D=ie.screenBoundB)||void 0===D?void 0:D.geometry)&&(null===(M=ie.screenBoundB)||void 0===M||M.geometry.dispose()),(null===(I=ie.screenBoundB)||void 0===I?void 0:I.object)&&this._scene.remove(null===(O=ie.screenBoundB)||void 0===O?void 0:O.object),(null===(A=ie.blendingGuideLineL)||void 0===A?void 0:A.geometry)&&(null===(k=ie.blendingGuideLineL)||void 0===k||k.geometry.dispose()),(null===(G=ie.blendingGuideLineL)||void 0===G?void 0:G.object)&&this._scene.remove(null===($=ie.blendingGuideLineL)||void 0===$?void 0:$.object),(null===(H=ie.blendingGuideLineR)||void 0===H?void 0:H.geometry)&&(null===(N=ie.blendingGuideLineR)||void 0===N||N.geometry.dispose()),(null===(q=ie.blendingGuideLineR)||void 0===q?void 0:q.object)&&this._scene.remove(null===(V=ie.blendingGuideLineR)||void 0===V?void 0:V.object),(null===(J=ie.blendingGuideLineT)||void 0===J?void 0:J.geometry)&&(null===(Z=ie.blendingGuideLineT)||void 0===Z||Z.geometry.dispose()),(null===(U=ie.blendingGuideLineT)||void 0===U?void 0:U.object)&&this._scene.remove(null===(W=ie.blendingGuideLineT)||void 0===W?void 0:W.object),(null===(Y=ie.blendingGuideLineB)||void 0===Y?void 0:Y.geometry)&&(null===(X=ie.blendingGuideLineB)||void 0===X||X.geometry.dispose()),(null===(F=ie.blendingGuideLineB)||void 0===F?void 0:F.object)&&this._scene.remove(null===(K=ie.blendingGuideLineB)||void 0===K?void 0:K.object),(null===(Q=ie.screenPlane)||void 0===Q?void 0:Q.geometry)&&(null===(ee=ie.screenPlane)||void 0===ee||ee.geometry.dispose()),(null===(te=ie.screenPlane)||void 0===te?void 0:te.object)&&this._scene.remove(null===(oe=ie.screenPlane)||void 0===oe?void 0:oe.object)}_createBoundLine(e){const t=this._projectors.find((t=>t.name===e)),o=z.default.state.projector.projectors.find((t=>t.uId===e)),i=z.default.state.projector.selectedProjectorUid===e;if(!t||!o)return;this._disposeBoundLine(e);const s=1/o.throwRatio/o.aspectRatio/2,r=1+(2*o.lensShiftV+o.offset)/100,n=180*Math.atan(s*r)/Math.PI,a=1-(2*o.lensShiftV+o.offset)/100,c=180*Math.atan(s*a)/Math.PI,h=1/o.throwRatio/2,l=1+2*o.lensShiftH/100,d=180*Math.atan(h*l)/Math.PI,u=1-2*o.lensShiftH/100,m=180*Math.atan(h*u)/Math.PI,_=(n-c)/2,p=(m-d)/2,g=new B.Pa4;g.set(Math.tan(m*Math.PI/180),Math.tan(n*Math.PI/180),1);const b=g.clone();this._applayDirectionRotation(g,t);const f=new B.Pa4;f.set(-Math.tan(d*Math.PI/180),Math.tan(n*Math.PI/180),1);const j=f.clone();this._applayDirectionRotation(f,t);const S=new B.Pa4;S.set(Math.tan(m*Math.PI/180),-Math.tan(c*Math.PI/180),1);const v=S.clone();this._applayDirectionRotation(S,t);const w=new B.Pa4;w.set(-Math.tan(d*Math.PI/180),-Math.tan(c*Math.PI/180),1);const y=w.clone();this._applayDirectionRotation(w,t);const P=new B.Pa4;if(P.set(Math.tan(p*Math.PI/180),Math.tan(_*Math.PI/180),1),this._applayDirectionRotation(P,t),t.lightBoundLT=this._createRayLine(t.position,g,i),t.lightBoundRT=this._createRayLine(t.position,f,i),t.lightBoundLB=this._createRayLine(t.position,S,i),t.lightBoundRB=this._createRayLine(t.position,w,i),z.default.commit("projector/SET_SELECTED_PROJECTOR_PROJECTION_DISTANCE",this._calcHitDistance(t.position,P)/this._roomSize.ratio),z.default.commit("projector/SET_SELECTED_PROJECTOR_AMBITENT_CONTRAST",(0,O.gh)(e)),z.default.commit("projector/SET_SELECTED_PROJECTOR_BRIGHTNESS_NIT",(0,O.vc)(e)),t.screenBoundL=this._createScreenBoundLine(t.position,b,v,"y",t,i),t.screenBoundR=this._createScreenBoundLine(t.position,j,y,"y",t,i),t.screenBoundT=this._createScreenBoundLine(t.position,b,j,"x",t,i),t.screenBoundB=this._createScreenBoundLine(t.position,v,y,"x",t,i),o.isShowBlendingGuideLine){const e=b.clone(),s=j.clone(),r=v.clone(),n=y.clone(),a=(s.x-e.x)*o.blendingGuideLineL/100/2,c=(s.x-e.x)*o.blendingGuideLineR/100/2,h=(r.y-e.y)*o.blendingGuideLineT/100/2,l=(r.y-e.y)*o.blendingGuideLineB/100/2;e.x+=a,e.y+=h,s.x-=c,s.y+=h,r.x+=a,r.y-=l,n.x-=c,n.y-=l,t.blendingGuideLineL=this._createBlendingGuideLine(t.position,e,r,"y",t,i),t.blendingGuideLineR=this._createBlendingGuideLine(t.position,s,n,"y",t,i),t.blendingGuideLineT=this._createBlendingGuideLine(t.position,e,s,"x",t,i),t.blendingGuideLineB=this._createBlendingGuideLine(t.position,r,n,"x",t,i)}t.screenPlane=this._createScreenPlane(t.position,b,v,y,t,o)}_applayDirectionRotation(e,t){const o=new B.Pa4(1,0,0),i=new B.Pa4(0,1,0),s=new B.Pa4(0,0,1);e.applyAxisAngle(o,t.rotation.x),e.applyAxisAngle(i,t.rotation.y),e.applyAxisAngle(s,t.rotation.z)}_createScreenBoundLine(e,t,o,i,s,r){const n=this._calcDivideCutPoints(e,t,o,i,s),a={geometry:null,object:null};a.geometry=new D.VJ,a.geometry.setPoints(n);const c=new D.r7({color:15689814,lineWidth:.4,transparent:!r,opacity:.6});return a.object=new B.Kj0(a.geometry,c),this._scene.add(a.object),a}_createBlendingGuideLine(e,t,o,i,s,r){const n=this._calcDivideCutPoints(e,t,o,i,s),a={geometry:null,object:null};a.geometry=new D.VJ,a.geometry.setPoints(n);const c=new D.r7({color:255,lineWidth:.4,transparent:!r,opacity:.6});return a.object=new B.Kj0(a.geometry,c),this._scene.add(a.object),a}_createScreenPlane(e,t,o,i,s,r){if(r.imageAspectRatio>r.aspectRatio){const e=(r.imageAspectRatio-r.aspectRatio)/r.imageAspectRatio*(t.y-o.y);t.y-=e/2,o.y+=e/2}else if(r.imageAspectRatio<r.aspectRatio){const e=(r.aspectRatio-r.imageAspectRatio)/r.aspectRatio*(o.x-i.x);o.x-=e/2,i.x+=e/2}const n=30,a=[],c=[],h=[],l=[],d=(t.y-o.y)/n;for(let b=0;b<=n;b++){const t=o.clone();t.y+=d*b;const r=i.clone();r.y+=d*b,l[b]=this._calcDivideCutPoints(e,t,r,"x",s)}for(let b=0;b<l.length;b++)for(let e=0;e<l[b].length;e++)if(l[b+1]&&l[b][e+1]){a.push(l[b][e].x),a.push(l[b][e].y),a.push(l[b][e].z),a.push(l[b+1][e].x),a.push(l[b+1][e].y),a.push(l[b+1][e].z),a.push(l[b+1][e+1].x),a.push(l[b+1][e+1].y),a.push(l[b+1][e+1].z),h.push(e/n),h.push(b/n),h.push(e/n),h.push((b+1)/n),h.push((e+1)/n),h.push((b+1)/n),a.push(l[b][e].x),a.push(l[b][e].y),a.push(l[b][e].z),a.push(l[b+1][e+1].x),a.push(l[b+1][e+1].y),a.push(l[b+1][e+1].z),a.push(l[b][e+1].x),a.push(l[b][e+1].y),a.push(l[b][e+1].z),h.push(e/n),h.push(b/n),h.push((e+1)/n),h.push((b+1)/n),h.push((e+1)/n),h.push(b/n);for(let e=0;e<6;e++)c.push(0),c.push(0),c.push(1)}const u={geometry:null,object:null};u.geometry=new B.u9r;const m=new Float32Array(a),_=new Float32Array(c),p=new Float32Array(h);u.geometry.setAttribute("position",new B.TlE(m,3)),u.geometry.setAttribute("normal",new B.TlE(_,3)),u.geometry.setAttribute("uv",new B.TlE(p,2));const g=new B.vBJ({side:B.ehD,transparent:!0,opacity:.75,color:16776415});return g.map=this._textures[r.texture],u.object=new B.Kj0(u.geometry,g),this._scene.add(u.object),u}_calcDivideCutPoints(e,t,o,i,s){const r=[],n=30,a=new B.Pa4(1,0,0),c=new B.Pa4(0,1,0),h=new B.Pa4(0,0,1),l=(t[i]-o[i])/n;for(let d=0;d<=n;d++){const o=t.clone();o[i]-=l*d,o.applyAxisAngle(a,s.rotation.x),o.applyAxisAngle(c,s.rotation.y),o.applyAxisAngle(h,s.rotation.z);const n=this._calcHitPoint(e,o);r.push(n)}return r}_createRayLine(e,t,o){const i=this._calcHitPoint(e,t),s=[e,i],r={geometry:null,object:null};r.geometry=new D.VJ,r.geometry.setPoints(s);const n=new D.r7({color:5263438,lineWidth:o?.5:.2,transparent:!o,opacity:.5});return r.object=new B.Kj0(r.geometry,n),this._scene.add(r.object),r}_createAllBoundLine(){this._projectors.forEach((e=>{this._createBoundLine(e.name)}))}_calcHitPoint(e,t){const o=t.normalize(),i=new B.iMs(e,o),s=[this._room.objects.back,this._room.objects.front,this._room.objects.left,this._room.objects.right,this._room.objects.top,this._room.objects.bottom,this._screen.object,...this._screen.object.children],r=i.intersectObjects(s);return 0===r.length?null:(r[0].point.x-=o.x,r[0].point.y-=o.y,r[0].point.z-=o.z,r[0].point)}_calcHitDistance(e,t){const o=this._calcHitPoint(e,t);return this._currentHitPoint=o,this._currentHitDirection=t,o.distanceTo(e)}}class k extends A{constructor(e){super(),this._init(e)}_init(e){this._initRenderer(e),this._initScene(),this._initControls(),this._initTransformControl(),this._initTexture().then((()=>{this._initRoom(),this._initScreen()})),this.setTheme()}setScreen(e){this._screenType=e,this._initScreen(),this._screen.object.updateMatrixWorld(),this._createAllBoundLine()}setRoomSize(){this._initRoom(),this._initLight()}setScreenPosition(){this._screen.object.position.x=z.default.state.screen.x*this._roomSize.ratio,this._screen.object.position.y=z.default.state.screen.y*this._roomSize.ratio,this._screen.object.position.z=z.default.state.screen.z*this._roomSize.ratio,this._screen.object.rotation.x=z.default.state.screen.rotateX/180*Math.PI,this._screen.object.rotation.y=z.default.state.screen.rotateY/180*Math.PI,this._screen.object.rotation.z=z.default.state.screen.rotateZ/180*Math.PI,this._screen.object.updateMatrixWorld(),this._createAllBoundLine()}addProjector(e){this._addProjecotr(e).then((e=>{this._projectors.push(e),z.default.commit("projector/SET_SELECTED_PROJECTOR_X",e.position.x/this._roomSize.ratio),z.default.commit("projector/SET_SELECTED_PROJECTOR_Y",e.position.y/this._roomSize.ratio),z.default.commit("projector/SET_SELECTED_PROJECTOR_Z",e.position.z/this._roomSize.ratio),this._createAllBoundLine()}))}setProjector(e){this._setTransformControl(e.uId);const t=this._projectors.find((t=>t.name===e.uId));t.position.x=e.x*this._roomSize.ratio,t.position.y=e.y*this._roomSize.ratio,t.position.z=e.z*this._roomSize.ratio,t.rotation.x=e.rotateX/180*Math.PI,t.rotation.y=e.rotateY/180*Math.PI,t.rotation.z=e.rotateZ/180*Math.PI,this._createAllBoundLine()}setProjectors(e){e.forEach((e=>{const t=this._projectors.find((t=>t.name===e.uId));t.position.x=e.x*this._roomSize.ratio,t.position.y=e.y*this._roomSize.ratio,t.position.z=e.z*this._roomSize.ratio,t.rotation.x=e.rotateX/180*Math.PI,t.rotation.y=e.rotateY/180*Math.PI,t.rotation.z=e.rotateZ/180*Math.PI})),this._createAllBoundLine()}deleteProjector(e){const t=this._projectors.find((t=>t.name===e));this._transformControl.object===t&&(this._scene.remove(this._transformControl.object.customLabel),this._transformControl.detach()),this._disposeBoundLine(e),this._scene.remove(t)}setProjectorTexture({patternSrc:e,isVideo:t}){z.default.commit("projector/SET_SELECTED_PROJECTOR_TEXTURE",e),!this._textures[e]&&e?this._loadTexture(e,t).then((t=>{this._textures[e]=t,this._createAllBoundLine()})):this._createAllBoundLine()}getDataUrl(){this._renderer.preserveDrawingBuffer=!0,this._render();const e=this._renderer.domElement.toDataURL("image/jpeg");return this._renderer.preserveDrawingBuffer=!1,e}changeCamera(){this._controls.saveState(),this._camera.position.set(this._transformControl.object.position.x+10*this._currentHitDirection.x,this._transformControl.object.position.y+10*this._currentHitDirection.y,this._transformControl.object.position.z+10*this._currentHitDirection.z),this._camera.lookAt(this._currentHitPoint.x,this._currentHitPoint.y,this._currentHitPoint.z)}resetCamera(){this._controls.reset()}}let G=null;const $={name:"PageIndex",components:{ProjectorDetail:R},created(){this.$bus.on("setScreen",this.setScreen),this.$bus.on("setScreenPosition",this.setScreenPosition),this.$bus.on("autoAdjustScreenPosition",this.autoAdjustScreenPosition),this.$bus.on("setRoomSize",this.setRoomSize),this.$bus.on("addProjector",this.addProjector),this.$bus.on("setProjector",this.setProjector),this.$bus.on("setProjectors",this.setProjectors),this.$bus.on("deleteProjector",this.deleteProjector),this.$bus.on("setProjectorTexture",this.setProjectorTexture),this.$bus.on("initThreeViewImage",this.initThreeViewImage)},beforeUnmount(){this.$bus.off("setScreen",this.setScreen),this.$bus.off("setScreenPosition",this.setScreenPosition),this.$bus.off("autoAdjustScreenPosition",this.autoAdjustScreenPosition),this.$bus.off("setRoomSize",this.setRoomSize),this.$bus.off("addProjector",this.addProjector),this.$bus.off("setProjector",this.setProjector),this.$bus.off("setProjectors",this.setProjectors),this.$bus.off("deleteProjector",this.deleteProjector),this.$bus.off("setProjectorTexture",this.setProjectorTexture),this.$bus.off("initThreeViewImage",this.initThreeViewImage)},mounted(){G=new k("#threeView"),G.animate()},data(){return{view:null}},methods:h()(h()({},(0,l.OI)("common",["SET_THREE_VIEW_IMAGE"])),{},{stylePage(e,t){return{height:t-e+"px"}},resizeCanvas(){G.onWindowResize()},setRoomSize(){G.setRoomSize()},setScreen(e){G.setScreen(e)},setScreenPosition(){G.setScreenPosition()},autoAdjustScreenPosition(){G.adjustScreenPosition()},addProjector(e){G.addProjector(e)},setProjector(e){G.setProjector(e)},setProjectors(e){G.setProjectors(e)},deleteProjector(e){G.deleteProjector(e)},setProjectorTexture(e){G.setProjectorTexture(e)},initThreeViewImage(){const e=G.getDataUrl();this.SET_THREE_VIEW_IMAGE(e)},changeCamera(){G.changeCamera()},resetCamera(){G.resetCamera()}})};var H=o(24379),N=o(48240),q=o(5363),V=o(15151);$.render=a,$.__scopeId="data-v-ebd4bd44";const J=$;T()($,"components",{QPage:H.Z,QBtn:N.Z,QTooltip:q.Z,QResizeObserver:V.Z})}}]);